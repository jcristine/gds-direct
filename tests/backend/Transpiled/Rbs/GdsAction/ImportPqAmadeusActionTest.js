// namespace Rbs\GdsDirect;

const StubLocationGeographyProvider = require('../../../../../backend/Transpiled/Rbs/DataProviders/StubLocationGeographyProvider.js');
const ImportPqAmadeusAction = require('../../../../../backend/Transpiled/Rbs/GdsDirect/Actions/Amadeus/ImportPqAmadeusAction.js');
const CommandParser = require('../../../../../backend/Transpiled/Gds/Parsers/Amadeus/CommandParser.js');
const UpdateAmadeusSessionStateAction = require('../../../../../backend/Transpiled/Rbs/GdsDirect/SessionStateProcessor/UpdateAmadeusStateAction.js');
const AnyGdsStubSession = require('../../Rbs/TestUtils/AnyGdsStubSession.js');
const GdsDirectDefaults = require('../../Rbs/TestUtils/GdsDirectDefaults.js');

const php = require('../../php.js');

class ImportPqAmadeusActionTest extends require('../../Lib/TestCase.js') {
	provideTestCases() {
		let $list, $argumentTuples, $testCase;

		$list = [];

		// multiple PTC-s * multiple Fare Components
		// very long, covers very many corner-cases
		$list.push({
			'input': {
				'useStatefulRules': true,
				'previousCommands': [
					{
						'cmd': 'FXX/RC05*ADT*C05*INF',
						'output': php.implode(php.PHP_EOL, [
							'FXX/RC05*ADT*C05*INF',
							'',
							'',
							'   PASSENGER         PTC    NP  FARE USD  TAX/FEE   PER PSGR',
							'01 1,3               CNN     2    1470.00  274.39    1744.39',
							'02 2                 ADT     1    2181.00  277.74    2458.74',
							'03 4                 INF     1     209.00    0.00     209.00',
							'',
							'                   TOTALS    4    5330.00  826.52    6156.52',
							'',
							'FXU/TS TO UPSELL BF- FOR -104.57USD',
							'1-3 FARE FAMILIES:EF',
							'1-3 LAST TKT DTE 11AUG17/12:14 LT in POS - SEE ADV PURCHASE',
							'1-3 SUBJ TO CANCELLATION/CHANGE PENALTY',
							'                                                  PAGE  2/ 2',
							'',
						]),
					},
				],
			},
			'output': {
				'allCommands': [
					{'cmd': 'RT', 'type': 'redisplayPnr'},
					{'cmd': 'FXX/RC05*ADT*C05*INF', 'type': 'priceItinerary'},
					{'cmd': 'FQQ1', 'type': 'priceItinerary'},
					{'cmd': 'FQQ2', 'type': 'priceItinerary'},
					{'cmd': 'FQQ3', 'type': 'priceItinerary'},
					{'cmd': 'DO1-4', 'type': 'flightServiceInfo'},
					{'cmd': 'FQN1*16', 'type': 'fareList'},
					{'cmd': 'FQN1-1*16', 'type': 'fareList'},
					{'cmd': 'FQN1-2*16', 'type': 'fareList'},
					{'cmd': 'FQN2*16', 'type': 'fareList'},
					{'cmd': 'FQN2-1*16', 'type': 'fareList'},
					{'cmd': 'FQN2-2*16', 'type': 'fareList'},
					{'cmd': 'FQN3*16', 'type': 'fareList'},
					{'cmd': 'FQN3-1*16', 'type': 'fareList'},
					{'cmd': 'FQN3-2*16', 'type': 'fareList'},
				],
				'pnrData': {
					'reservation': {
						'parsed': {
							'itinerary': [
								{
									'segmentNumber': '1',
									'bookingClass': 'Y',
									'departureAirport': 'KIV',
									'destinationAirport': 'SVO',
									'eticket': true,
								},
								{
									'destinationAirport': 'RIX',
								},
								{
									'departureAirport': 'RIX',
								},
							],
						},
					},
					'flightServiceInfo': {
						'parsed': {
							'segments': [
								{
									'segmentNumber': '1',
									'legs': [
										{
											'meals': {
												'raw': 'JCDIZO/D Y/S BMUKHLXQTEN/S RGV/S',
												'parsed': ['SNACK'],
											},
											'aircraft': '32A',
											'flightDuration': '2:55',
											'departureDt': {
												'full': '2017-12-10 01:40:00',
											},
											'destinationDt': {
												'full': '2017-12-10 05:35:00',
											},
										},
									],
								},
								{
									'segmentNumber': '2',
									'legs': [
										{'flightDuration': '1:40'},
									],
								},
								{
									'segmentNumber': '3',
									'legs': [
										{'flightDuration': '1:25'},
									],
								},
							],
						},
					},
					'currentPricing': {
						'cmd': 'FXX/RC05*ADT*C05*INF',
						'parsed': {
							'pricingList': [
								{
									'pricingModifiers': [
										{
											'raw': 'RC05*ADT*C05*INF',
											'type': 'generic',
											'parsed': {'ptcs': ['C05', 'ADT', 'C05', 'INF']},
										},
									],
									'pricingBlockList': [
										{
											'ptcInfo': {'ptc': 'CNN', 'ptcRequested': 'C05', 'quantity': '2'},
											'validatingCarrier': 'LO',
											'fareInfo': {
												'baseFare': {'currency': 'EUR', 'amount': '1240.00'},
												'fareEquivalent': {'currency': 'USD', 'amount': '1470.00'},
												'totalFare': {'currency': 'USD', 'amount': '1744.39'},
												'taxList': [
													{'taxCode': 'YQ', 'amount': '214.80'},
													{'taxCode': 'JQ', 'amount': '2.96'},
													{'taxCode': 'MD', 'amount': '10.67'},
													{'taxCode': 'WW', 'amount': '7.35'},
													{'taxCode': 'RI', 'amount': '3.34'},
													{'taxCode': 'RI', 'amount': '6.69'},
													{'taxCode': 'LV', 'amount': '4.13'},
													{'taxCode': 'XM', 'amount': '7.71'},
													{'taxCode': 'XW', 'amount': '16.74'},
												],
												'fareConstruction': {
													'segments': [
														{'destination': 'MOW'},
														{'destination': 'RIX', 'fare': '360.25'},
														{'destination': 'WAW'},
														{'destination': 'TYO', 'fare': '936.83'},
													],
												},
											},
										},
										{
											'ptcInfo': {'ptc': 'ADT', 'ptcRequested': 'ADT', 'quantity': '1'},
											'validatingCarrier': 'LO',
											'fareInfo': {
												'baseFare': {'currency': 'EUR', 'amount': '1839.00'},
												'fareEquivalent': {'currency': 'USD', 'amount': '2181.00'},
												'totalFare': {'currency': 'USD', 'amount': '2458.74'},
												'taxList': [
													{'amount': '214.80', 'taxCode': 'YQ'},
													// and so on...
												],
												'fareConstruction': {
													'segments': [
														{'destination': 'MOW'},
														{'destination': 'RIX', 'fare': '720.51'},
														{'destination': 'WAW'},
														{'destination': 'TYO', 'fare': '1249.11'},
													],
												},
											},
										},
										{
											'ptcInfo': {'ptc': 'INF', 'ptcRequested': 'INF', 'quantity': '1'},
											'fareInfo': {
												'baseFare': {'currency': 'EUR', 'amount': '176.00'},
												'fareEquivalent': {'currency': 'USD', 'amount': '209.00'},
												'totalFare': {'currency': 'USD', 'amount': '209.00'},
												'fareConstruction': {
													'segments': [
														{'destination': 'MOW'},
														{'destination': 'RIX', 'fare': '72.05'},
														{'destination': 'WAW'},
														{'destination': 'TYO', 'fare': '124.91'},
													],
												},
											},
										},
									],
								},
							],
						},
					},
					'bagPtcPricingBlocks': [
						{
							'ptcInfo': {'ptc': 'CNN', 'ptcRequested': 'C05', 'quantity': '2'},
							'parsed': {
								'baggageAllowanceBlocks': [
									{
										'ptc': 'CNN',
										'segments': [
											{
												'segmentDetails': {
													'departureAirport': 'KIV',
													'destinationAirport': 'MOW'
												},
												'bags': [
													{'flags': ['noFeeFlag'], 'bagNumber': 1},
													{'flags': ['noFeeFlag'], 'bagNumber': 2},
												],
											},
											{
												'segmentDetails': {
													'departureAirport': 'MOW',
													'destinationAirport': 'RIX'
												},
												'bags': [
													{'flags': ['noFeeFlag'], 'bagNumber': 1},
													{'flags': ['noFeeFlag'], 'bagNumber': 2},
												],
											},
											{
												'segmentDetails': {
													'departureAirport': 'RIX',
													'destinationAirport': 'WAW'
												},
												'bags': [
													{'flags': ['noFeeFlag'], 'bagNumber': 1},
												],
											},
											{
												'segmentDetails': {
													'departureAirport': 'WAW',
													'destinationAirport': 'TYO'
												},
												'bags': [
													{'flags': ['noFeeFlag'], 'bagNumber': 1},
												],
											},
										],
									},
								],
							},
						},
						{
							'ptcInfo': {'ptc': 'ADT', 'ptcRequested': 'ADT', 'quantity': '1'},
						},
						{
							'ptcInfo': {'ptc': 'INF', 'ptcRequested': 'INF', 'quantity': '1'},
						},
					],
					'fareComponentListInfo': [
						{
							'subPricingNumber': 1,
							'parsed': [
								{
									'componentNumber': '1',
									'segmentNumbers': ['1', '2'],
									'departureAirport': 'KIV',
									'destinationAirport': 'RIX',
									'fareBasis': 'YFO',
								},
								{
									'componentNumber': '2',
									'segmentNumbers': ['3', '4'],
									'departureAirport': 'RIX',
									'destinationAirport': 'NRT',
									'fareBasis': 'Y1RED',
								},
							],
						},
						{
							'subPricingNumber': 2,
							'parsed': [
								{
									'componentNumber': '1',
									'segmentNumbers': ['1', '2'],
									'departureAirport': 'KIV',
									'destinationAirport': 'RIX',
									'fareBasis': 'YFO',
								},
								{
									'componentNumber': '2',
									'segmentNumbers': ['3', '4'],
									'departureAirport': 'RIX',
									'destinationAirport': 'NRT',
									'fareBasis': 'Y1RED',
								},
							],
						},
						{
							'subPricingNumber': 3,
							'parsed': [
								{
									'componentNumber': '1',
									'segmentNumbers': ['1', '2'],
									'departureAirport': 'KIV',
									'destinationAirport': 'RIX',
									'fareBasis': 'YFO',
								},
								{
									'componentNumber': '2',
									'segmentNumbers': ['3', '4'],
									'departureAirport': 'RIX',
									'destinationAirport': 'NRT',
									'fareBasis': 'Y1RED',
								},
							],
						},
					],
					'fareRules': [
						{
							'subPricingNumber': 1,
							'fareComponentNumber': '1',
							'sections': {
								'exchange': {
									'doesApply': true,
									'parsed': [
										{'conditions': ['FOR ECONOMY UNRESTRICTED FARES']},
									],
								},
							},
						},
						{
							'subPricingNumber': 1,
							'fareComponentNumber': '2',
							'sections': {
								'exchange': {
									'doesApply': true,
									'parsed': [
										{
											'conditions': [],
											'penalties': [
												{
													'actionName': 'cancellations',
													'when': 'beforeDeparture',
													'prices': [
														{'violations': ['any'], 'isPermitted': true},
													],
												},
												{
													'actionName': 'cancellations',
													'when': 'afterDeparture',
													'prices': [
														{'violations': ['any'], 'isPermitted': true},
													],
												},
												{
													'actionName': 'changes',
													'when': 'afterDeparture',
													'prices': [
														{
															'violations': ['reissue', 'revalidation'],
															'isPermitted': true
														},
													],
												},
											],
										},
									],
								},
							},
						},
						{
							'subPricingNumber': 2,
							'fareComponentNumber': '1',
							'sections': {
								'exchange': {
									'doesApply': true,
									'parsed': [
										{'conditions': ['FOR ECONOMY UNRESTRICTED FARES']},
									],
								},
							},
						},
						{
							'subPricingNumber': 2,
							'fareComponentNumber': '2',
							'sections': {
								'exchange': {
									'doesApply': true,
									'parsed': [
										{
											'conditions': [],
											'penalties': [
												{
													'actionName': 'cancellations',
													'when': 'beforeDeparture',
													'prices': [
														{'violations': ['any'], 'isPermitted': true},
													],
												},
												{
													'actionName': 'cancellations',
													'when': 'afterDeparture',
													'prices': [
														{'violations': ['any'], 'isPermitted': true},
													],
												},
												{
													'actionName': 'changes',
													'when': 'afterDeparture',
													'prices': [
														{
															'violations': ['reissue', 'revalidation'],
															'isPermitted': true
														},
													],
												},
											],
										},
									],
								},
							},
						},
						{
							'subPricingNumber': 3,
							'fareComponentNumber': '1',
							'sections': {
								'exchange': {
									'doesApply': true,
									'parsed': [
										{'conditions': ['FOR ECONOMY UNRESTRICTED FARES']},
									],
								},
							},
						},
						{
							'subPricingNumber': 3,
							'fareComponentNumber': '2',
							'sections': {
								'exchange': {
									'doesApply': true,
									'parsed': [
										{
											'conditions': [],
											'penalties': [
												{
													'actionName': 'cancellations',
													'when': 'beforeDeparture',
													'prices': [
														{'violations': ['any'], 'isPermitted': true},
													],
												},
												{
													'actionName': 'cancellations',
													'when': 'afterDeparture',
													'prices': [
														{'violations': ['any'], 'isPermitted': true},
													],
												},
												{
													'actionName': 'changes',
													'when': 'afterDeparture',
													'prices': [
														{
															'violations': ['reissue', 'revalidation'],
															'isPermitted': true
														},
													],
												},
											],
										},
									],
								},
							},
						},
					],
				},
			},
			'calledCommands': [
				{
					'cmd': 'RT',
					'output': php.implode(php.PHP_EOL, [
						'/$--- MSC ---',
						'RP/SFO1S2195/',
						'  1  SU1845 Y 10DEC 7*KIVSVO DK1   140A 535A 10DEC  E  0 32A S',
						'     SEE RTSVC',
						'  2  SU2682 Y 10DEC 7*SVORIX DK1   925A1005A 10DEC  E  0 320 S',
						'     SEE RTSVC',
						'  3  LO 794 Y 20DEC 3 RIXWAW DK1   600A 625A 20DEC  E  0 DH4 RF',
						'     SEE RTSVC',
						'  4  LO 079 Y 20DEC 3 WAWNRT DK1   240P 915A 21DEC  E  0 788 DB',
						'     SEE RTSVC',
						' ',
					]),
				},
				{
					'cmd': 'FQQ1',
					'output': php.implode(php.PHP_EOL, [
						'FQQ1',
						'',
						'01 P1',
						'',
						'LAST TKT DTE 11AUG17/12:14 LT in POS - SEE ADV PURCHASE',
						'------------------------------------------------------------',
						'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
						' KIV',
						'XMOW SU  1845 Y    10DEC 0140  YFO/CH50                   2P',
						' RIX SU  2682 Y    10DEC 0925  YFO/CH50                   2P',
						'XWAW LO   794 Y    20DEC 0600  Y1RED/CH25                 1P',
						' TYO LO    79 Y    20DEC 1440  Y1RED/CH25                 1P',
						'',
						'EUR  1240.00      10DEC17KIV SU X/MOW Q47.13SU RIX Q47.13',
						'USD  1470.00      360.25YFO/CH50 LO X/WAW LO TYO936.83Y1RED/',
						'USD   214.80YQ    CH25 NUC1391.34END ROE0.891032',
						'USD     2.96JQ    XT USD 10.67MD USD 7.35WW USD 3.34RI USD',
						'USD    56.63XT    6.69RI USD 4.13LV USD 7.71XM USD 16.74XW',
						'USD  1744.39',
						'RATE USED 1EUR=1.185793USD',
						'FARE FAMILIES:    (ENTER FQFn FOR DETAILS, FXY FOR UPSELL)',
						'                                                  PAGE  3/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'FARE FAMILY:FC1:1-2:EF',
						'FXU/TS TO UPSELL BF- FOR 70.81USD',
						'TICKET STOCK RESTRICTION',
						'BG CXR: 2*SU/2*LO',
						'PRICED WITH VALIDATING CARRIER LO - REPRICE IF DIFFERENT VC',
						'SUBJ TO CANCELLATION/CHANGE PENALTY',
						'08AUG17 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
						'                                                  PAGE  4/ 4',
						' ',
					]),
				},
				{
					'cmd': 'FQQ2',
					'output': php.implode(php.PHP_EOL, [
						'FQQ2',
						'',
						'02 P2',
						'',
						'LAST TKT DTE 11AUG17/12:14 LT in POS - SEE ADV PURCHASE',
						'------------------------------------------------------------',
						'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
						' KIV',
						'XMOW SU  1845 Y    10DEC 0140  YFO                        2P',
						' RIX SU  2682 Y    10DEC 0925  YFO                        2P',
						'XWAW LO   794 Y    20DEC 0600  Y1RED                      1P',
						' TYO LO    79 Y    20DEC 1440  Y1RED                      1P',
						'',
						'EUR  1839.00      10DEC17KIV SU X/MOW Q47.13SU RIX Q47.13',
						'USD  2181.00      720.51YFO LO X/WAW LO TYO1249.11Y1RED NUC',
						'USD   214.80YQ    2063.88END ROE0.891032',
						'USD     2.96JQ    XT USD 10.67MD USD 7.35WW USD 6.69RI USD',
						'USD    59.98XT    6.69RI USD 4.13LV USD 7.71XM USD 16.74XW',
						'USD  2458.74',
						'RATE USED 1EUR=1.185793USD',
						'FARE FAMILIES:    (ENTER FQFn FOR DETAILS, FXY FOR UPSELL)',
						'                                                  PAGE  3/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'FARE FAMILY:FC1:1-2:EF',
						'FXU/TS TO UPSELL BF- FOR -210.19USD',
						'TICKET STOCK RESTRICTION',
						'BG CXR: 2*SU/2*LO',
						'PRICED WITH VALIDATING CARRIER LO - REPRICE IF DIFFERENT VC',
						'SUBJ TO CANCELLATION/CHANGE PENALTY',
						'08AUG17 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
						'                                                  PAGE  4/ 4',
						' ',
					]),
				},
				{
					'cmd': 'FQQ3',
					'output': php.implode(php.PHP_EOL, [
						'FQQ3',
						'',
						'03',
						'',
						'LAST TKT DTE 11AUG17/12:14 LT in POS - SEE ADV PURCHASE',
						'------------------------------------------------------------',
						'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
						' KIV',
						'XMOW SU  1845 Y    10DEC 0140  YFO/IN90                   1P',
						' RIX SU  2682 Y    10DEC 0925  YFO/IN90                   1P',
						'XWAW LO   794 Y    20DEC 0600  Y1RED/IN90                 1P',
						' TYO LO    79 Y    20DEC 1440  Y1RED/IN90                 1P',
						'',
						'EUR   176.00      10DEC17KIV SU X/MOW SU RIX72.05YFO/IN90 LO',
						'USD   209.00      X/WAW LO TYO124.91Y1RED/IN90 NUC196.96END',
						'                  ROE0.891032',
						'',
						'',
						'USD   209.00',
						'RATE USED 1EUR=1.185793USD',
						'FARE FAMILIES:    (ENTER FQFn FOR DETAILS, FXY FOR UPSELL)',
						'                                                  PAGE  3/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'FARE FAMILY:FC1:1-2:EF',
						'FXU/TS TO UPSELL BF- FOR -36.00USD',
						'TICKET STOCK RESTRICTION',
						'BG CXR: 2*SU/2*LO',
						'PRICED WITH VALIDATING CARRIER LO - REPRICE IF DIFFERENT VC',
						'SUBJ TO CANCELLATION/CHANGE PENALTY',
						'08AUG17 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
						'                                                  PAGE  4/ 4',
						' ',
					]),
				},
				{
					'cmd': 'DO1-4',
					'output': php.implode(php.PHP_EOL, [
						'/$DO1-4',
						'*1A PLANNED FLIGHT INFO*              SU1845  124 SU 10DEC17    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'KIV          0140  SU JCDIZO/D  Y/S       32A         2:55      ',
						'                      BMUKHLXQTEN/S                             ',
						'                      RGV/S                                     ',
						'SVO 0535  SU                                                2:55',
						'',
						'COMMENTS-',
						' 1.KIV SVO   - ARRIVES TERMINAL D                               ',
						' 2.KIV SVO   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 3.KIV SVO   - Z999                                             ',
						' 4.KIV SVO   -  CO2/PAX* 120.74 KG ECO, 120.74 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               32A  NO CONFIGURATION SET                        ',
						'*1A PLANNED FLIGHT INFO*              SU2682  124 SU 10DEC17    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'SVO          0925  SU JCDIZOYBMUK/S       320         1:40      ',
						'                      HLXQTENRGV/S                              ',
						'RIX 1005  SU                                                1:40',
						'',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$COMMENTS-',
						' 1.SVO RIX   - DEPARTS TERMINAL D                               ',
						' 2.SVO RIX   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 3.SVO RIX   - Z999                                             ',
						' 4.SVO RIX   -  CO2/PAX* 123.01 KG ECO, 123.01 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               320  NO CONFIGURATION SET                        ',
						'*1A PLANNED FLIGHT INFO*              LO 794  134 WE 20DEC17    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'RIX          0600  WE CDZPAR/M  J/RF      DH4         1:25      ',
						'                      YBMEHKQGTSV/RF                            ',
						'                      WLUO/RF                                   ',
						'WAW 0625  WE                                                1:25',
						'',
						'COMMENTS-',
						' 1.RIX WAW   -   9/ NON-SMOKING                                 ',
						' 2.RIX WAW   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 3.RIX WAW   -  CO2/PAX* 77.81 KG ECO, 77.81 KG PRE             ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$               DH4  C   3   P   4   Y  68                       ',
						'*1A PLANNED FLIGHT INFO*              LO  79  134 WE 20DEC17    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'WAW          1440  WE CDZPARJYBME/DB      788        10:35      ',
						'                      HKQGTSVWLUO/DB                            ',
						'NRT 0915  TH                                               10:35',
						'',
						'COMMENTS-',
						' 1.WAW NRT   - ARRIVES TERMINAL 1                               ',
						' 2.WAW NRT   -   9/ NON-SMOKING                                 ',
						' 3.WAW NRT   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 4.WAW NRT   -  CO2/PAX* 346.46 KG ECO, 692.93 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               788  C  18   P  21   Y 213                       ',
						' ',
					]),
				},
				{
					'cmd': 'FQN1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1*16',
						'',
						'1 - PTC 1/3 C05',
						' FQN 1-1    CNN KIVRIX SU  YFO               FF : EF',
						' FQN 1-2    CNN RIXTYO LO  Y1RED',
						'                                                  PAGE  1/ 1',
						' ',
					]),
				},
				{
					'cmd': 'FQN1-1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1-1*16',
						'',
						' 1 - PTC 1/3 C05                                   RULES DISPLAY',
						'FARE COMPONENT  1    CNN KIVRIX SU  YFO',
						'FCL: YFO       TRF:  21 RULE: EF01 BK:  Y',
						'PTC: CNN-CHILD              FTC: EU -ECONOMY UNRESTRICTED',
						'FARE FAMILY            : EF',
						'PE.PENALTIES',
						'FOR ECONOMY UNRESTRICTED FARES',
						'',
						'',
						'         NOTE -',
						'          // CANCELLATION PROVISIONS //',
						'          ---',
						'          CHARGE APPLY PER TRANSACTIONS.',
						'          CHILD DISCOUNT DOES NOT APPLY.',
						'          INFANT WITHOUT A SEAT FREE OF CHARGE.',
						'          ---',
						'          ONLY FARE IN SAME BRAND CAN BE USED FOR REFUND',
						'          PROCEDURE OF PARTLY USED TICKET.',
						'          FARES DIVIDED INTO BRANDS BY FOLLOWING -',
						'                                                  PAGE  1/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          PROMO - FARES WITH PREFIX -SX/-SO',
						'          BUDGET/SAVER - FARES WITH PREFIX -VU/-VO',
						'          OPTIMUM/CLASSIC - FARES WITH PREFIX -CL/-CO',
						'          PREMIUM/FLEX - FARES WITH PREFIX -FM/-FO',
						'          //',
						'          WHEN COMBINING ON A HALF ROUNDTRIP BASIS THE',
						'          MOST RESTRICTIVE CANCELLATION CONDITION APPLIES',
						'          FOR THE ENTIRE PRICING UNIT.',
						'          ---',
						'          PENALTIES WAIVED IN CASE OF INVOLUNTARY REFUND.',
						'          CONTACT CARRIER FOR DETAILS.',
						'          ---',
						'          REFUND OF UNUSED FEES AND TAXES PERMITTED DURING',
						'          TICKET VALIDITY PERIOD.',
						'          ---',
						'          PAPER TICKET SURCHARGE IS NOT REFUNDABLE WHEN',
						'          APPLIED.',
						'          ---',
						'          IN CASE OF CANCELLATION AFTER DEPARTURE REFUND',
						'          THE DIFFERENCE BETWEEN THE FARE PAID AND THE',
						'          APPLICABLE FARE FLOWN.',
						'                                                  PAGE  2/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          WHEN REPRICING FARES FOR FLOWN ITINERARY FARES IN',
						'          LOWER RBD THAN SHOWN IN USED COUPONS CANNOT APPLY.',
						'          ---',
						'          REFUND CAN ONLY BE MADE THROUGH ISSUING OFFICE.',
						'          ---',
						'          // CHANGES PROVISIONS //',
						'          ---',
						'          CHARGE APPLY PER TRANSACTION.',
						'          CHILD DISCOUNT APPLY.',
						'          INFANT WITHOUT A SEAT FREE OF CHARGE.',
						'          CHANGE PERMITTED ONLY WITHIN SAME BRAND.',
						'          FARES DIVIDED INTO BRANDS BY FOLLOWING -',
						'          PROMO - FARES WITH PREFIX -SX/-SO',
						'          BUDGET/SAVER - FARES WITH PREFIX -VU/-VO',
						'          OPTIMUM/CLASSIC - FARES WITH PREFIX -CL/-CO',
						'          PREMIUM/FLEX - FARES WITH PREFIX -FM/-FO',
						'          //',
						'          ---',
						'          CHANGE IS A ROUTING/DATE/FLIGHT/BOOKING CLASS/FARE',
						'          MODIFICATION.',
						'          ---',
						'                                                  PAGE  3/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          RULES FOR CHANGES APPLY BY FARE',
						'          COMPONENT/DIRECTION.',
						'          IN CASE OF FARE COMBINATION CHARGE THE HIGHEST',
						'          FEE OF ALL CHANGED FARE COMPONENTS.',
						'          ---',
						'          NEW FARE AMOUNT SHOULD BE EQUAL OR HIGHER THAN',
						'          PREVIOUS AMOUNT.',
						'          ---',
						'          WHEN COMBINING NORMAL FARE WITH SPECIAL FARE ON A',
						'          HALF ROUNDTRIP BASIS NEW FARE AMOUNT SHOULD BE',
						'          EQUAL OR HIGHER THAN THE PREVIOUS AMOUNT.',
						'          FOR THE ITINERARIES WHERE JFM/JFO/WFM/WFO/YFM/YFO',
						'          FARES APPLIED TO THE ENTIRE ITINERARY',
						'          DOWNGRAIDING IS PERMITTED ONLY TO ABOVE MENTIONED',
						'          FARES.',
						'                                                  PAGE  4/ 4',
						' ',
					]),
				},
				{
					'cmd': 'FQN1-2*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1-2*16',
						'',
						' 1 - PTC 1/3 C05                                   RULES DISPLAY',
						'FARE COMPONENT  2    CNN RIXTYO LO  Y1RED',
						'FCL: Y1RED     TRF:  44 RULE: JP05 BK:  Y',
						'PTC: CNN-CHILD              FTC: EU -ECONOMY UNRESTRICTED',
						'PE.PENALTIES',
						'',
						'  CANCELLATIONS',
						'',
						'    BEFORE DEPARTURE',
						'      CANCELLATIONS PERMITTED.',
						'',
						'    AFTER DEPARTURE',
						'      CANCELLATIONS PERMITTED.',
						'',
						'  CHANGES',
						'',
						'    CHANGES PERMITTED FOR REISSUE/REVALIDATION.',
						'         NOTE -',
						'          CHARGE APPLIES PER TRANSACTION.',
						'                                                  PAGE  1/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          ------------------------------------',
						'          REBOOKING/REISSUE IS A ROUTING/DATE/FARE BASIS/',
						'          FLIGHT MODIFICATION.',
						'          WHEN MORE THAN ONE FARE COMPONENTS IS BEING',
						'          CHANGED THE HIGHEST OF PENALTIES OF ALL CHANGED',
						'          FARE COMPONENTS WILL APPLY.',
						'          ------------------------------------',
						'          FARE CAN BE REISSUED TO OTHER INTERNATIONAL FARES',
						'          THAT ARE EQUAL OR HIGHER THAN THE ORIGINAL FARES.',
						'          ALL CONDITIONS OF THE NEW FARE MUST BE MET',
						'          AND PASSENGER PAYS THE DIFFERENCE IN FARE PLUS',
						'          CHANGE OF RESERVATION FEE IF ANY APPLIES.',
						'          -----------------------------',
						'          IN CASE OF FARE COMBINATIONS PENALTY APPLIES PER',
						'          FARE COMPONENT ACCORDING TO RESTRICTIONS OF',
						'          FARE USED FOR PORTION OF TRAVEL. WHEN MORE THAN',
						'          ONE FARE COMPONENTS IS BEING CHANGED THE HIGHEST',
						'          OF PENALTIES OF ALL CHANGED FARE COMPONENTS WILL',
						'          APPLY.',
						'          -------------------------------',
						'          CHANGE OF FARE BREAK POINT PERMITTED - TICKET MUST',
						'                                                  PAGE  2/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          BE EXCHANGED MANUALLY.',
						'          -------------------------------',
						'                // IN THE EVENT OF NO SHOW //',
						'            WHEN CHANGES ARE REQUESTED AFTER DEPARTURE',
						'            OF THE ORIGINALLY SCHEDULED FLIGHT',
						'          - WHOLE TICKET MUST BE RECALCULATED FROM THE POINT',
						'          OF ORIGIN AND FARE ON A FARE COMPONENT PASSENEGER',
						'          IS NO SHOW MUST BE UPGRADED TO ANY HIGHER -RED',
						'          OR -PMLO OR FULL BUSINESS INTERNATIONAL',
						'          FARES /EXCLUDING BOX AND BX FARE TYPE CODES/ AND',
						'          PASSENEGER PAYS THE DIFFERENCE IN FARES.',
						'          OR',
						'           - TICKET MUST BE REFUNDED - CANCELLATION RULES',
						'          APPLIES.',
						'                                                  PAGE  3/ 3',
						' ',
					]),
				},
				{
					'cmd': 'FQN2*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN2*16',
						'',
						'2 - PTC 2 ADT',
						' FQN 2-1    ADT KIVRIX SU  YFO               FF : EF',
						' FQN 2-2    ADT RIXTYO LO  Y1RED',
						'                                                  PAGE  1/ 1',
						' ',
					]),
				},
				{
					'cmd': 'FQN2-1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN2-1*16',
						'',
						' 2 - PTC 2 ADT                                     RULES DISPLAY',
						'FARE COMPONENT  1    ADT KIVRIX SU  YFO',
						'FCL: YFO       TRF:  21 RULE: EF01 BK:  Y',
						'PTC: ADT-ADULT              FTC: EU -ECONOMY UNRESTRICTED',
						'FARE FAMILY            : EF',
						'PE.PENALTIES',
						'FOR ECONOMY UNRESTRICTED FARES',
						'',
						'',
						'         NOTE -',
						'          // CANCELLATION PROVISIONS //',
						'          ---',
						'          CHARGE APPLY PER TRANSACTIONS.',
						'          CHILD DISCOUNT DOES NOT APPLY.',
						'          INFANT WITHOUT A SEAT FREE OF CHARGE.',
						'          ---',
						'          ONLY FARE IN SAME BRAND CAN BE USED FOR REFUND',
						'          PROCEDURE OF PARTLY USED TICKET.',
						'          FARES DIVIDED INTO BRANDS BY FOLLOWING -',
						'                                                  PAGE  1/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          PROMO - FARES WITH PREFIX -SX/-SO',
						'          BUDGET/SAVER - FARES WITH PREFIX -VU/-VO',
						'          OPTIMUM/CLASSIC - FARES WITH PREFIX -CL/-CO',
						'          PREMIUM/FLEX - FARES WITH PREFIX -FM/-FO',
						'          //',
						'          WHEN COMBINING ON A HALF ROUNDTRIP BASIS THE',
						'          MOST RESTRICTIVE CANCELLATION CONDITION APPLIES',
						'          FOR THE ENTIRE PRICING UNIT.',
						'          ---',
						'          PENALTIES WAIVED IN CASE OF INVOLUNTARY REFUND.',
						'          CONTACT CARRIER FOR DETAILS.',
						'          ---',
						'          REFUND OF UNUSED FEES AND TAXES PERMITTED DURING',
						'          TICKET VALIDITY PERIOD.',
						'          ---',
						'          PAPER TICKET SURCHARGE IS NOT REFUNDABLE WHEN',
						'          APPLIED.',
						'          ---',
						'          IN CASE OF CANCELLATION AFTER DEPARTURE REFUND',
						'          THE DIFFERENCE BETWEEN THE FARE PAID AND THE',
						'          APPLICABLE FARE FLOWN.',
						'                                                  PAGE  2/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          WHEN REPRICING FARES FOR FLOWN ITINERARY FARES IN',
						'          LOWER RBD THAN SHOWN IN USED COUPONS CANNOT APPLY.',
						'          ---',
						'          REFUND CAN ONLY BE MADE THROUGH ISSUING OFFICE.',
						'          ---',
						'          // CHANGES PROVISIONS //',
						'          ---',
						'          CHARGE APPLY PER TRANSACTION.',
						'          CHILD DISCOUNT APPLY.',
						'          INFANT WITHOUT A SEAT FREE OF CHARGE.',
						'          CHANGE PERMITTED ONLY WITHIN SAME BRAND.',
						'          FARES DIVIDED INTO BRANDS BY FOLLOWING -',
						'          PROMO - FARES WITH PREFIX -SX/-SO',
						'          BUDGET/SAVER - FARES WITH PREFIX -VU/-VO',
						'          OPTIMUM/CLASSIC - FARES WITH PREFIX -CL/-CO',
						'          PREMIUM/FLEX - FARES WITH PREFIX -FM/-FO',
						'          //',
						'          ---',
						'          CHANGE IS A ROUTING/DATE/FLIGHT/BOOKING CLASS/FARE',
						'          MODIFICATION.',
						'          ---',
						'                                                  PAGE  3/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          RULES FOR CHANGES APPLY BY FARE',
						'          COMPONENT/DIRECTION.',
						'          IN CASE OF FARE COMBINATION CHARGE THE HIGHEST',
						'          FEE OF ALL CHANGED FARE COMPONENTS.',
						'          ---',
						'          NEW FARE AMOUNT SHOULD BE EQUAL OR HIGHER THAN',
						'          PREVIOUS AMOUNT.',
						'          ---',
						'          WHEN COMBINING NORMAL FARE WITH SPECIAL FARE ON A',
						'          HALF ROUNDTRIP BASIS NEW FARE AMOUNT SHOULD BE',
						'          EQUAL OR HIGHER THAN THE PREVIOUS AMOUNT.',
						'          FOR THE ITINERARIES WHERE JFM/JFO/WFM/WFO/YFM/YFO',
						'          FARES APPLIED TO THE ENTIRE ITINERARY',
						'          DOWNGRAIDING IS PERMITTED ONLY TO ABOVE MENTIONED',
						'          FARES.',
						'                                                  PAGE  4/ 4',
						' ',
					]),
				},
				{
					'cmd': 'FQN2-2*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN2-2*16',
						'',
						' 2 - PTC 2 ADT                                     RULES DISPLAY',
						'FARE COMPONENT  2    ADT RIXTYO LO  Y1RED',
						'FCL: Y1RED     TRF:  44 RULE: JP05 BK:  Y',
						'PTC: ADT-ADULT              FTC: EU -ECONOMY UNRESTRICTED',
						'PE.PENALTIES',
						'',
						'  CANCELLATIONS',
						'',
						'    BEFORE DEPARTURE',
						'      CANCELLATIONS PERMITTED.',
						'',
						'    AFTER DEPARTURE',
						'      CANCELLATIONS PERMITTED.',
						'',
						'  CHANGES',
						'',
						'    CHANGES PERMITTED FOR REISSUE/REVALIDATION.',
						'         NOTE -',
						'          CHARGE APPLIES PER TRANSACTION.',
						'                                                  PAGE  1/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          ------------------------------------',
						'          REBOOKING/REISSUE IS A ROUTING/DATE/FARE BASIS/',
						'          FLIGHT MODIFICATION.',
						'          WHEN MORE THAN ONE FARE COMPONENTS IS BEING',
						'          CHANGED THE HIGHEST OF PENALTIES OF ALL CHANGED',
						'          FARE COMPONENTS WILL APPLY.',
						'          ------------------------------------',
						'          FARE CAN BE REISSUED TO OTHER INTERNATIONAL FARES',
						'          THAT ARE EQUAL OR HIGHER THAN THE ORIGINAL FARES.',
						'          ALL CONDITIONS OF THE NEW FARE MUST BE MET',
						'          AND PASSENGER PAYS THE DIFFERENCE IN FARE PLUS',
						'          CHANGE OF RESERVATION FEE IF ANY APPLIES.',
						'          -----------------------------',
						'          IN CASE OF FARE COMBINATIONS PENALTY APPLIES PER',
						'          FARE COMPONENT ACCORDING TO RESTRICTIONS OF',
						'          FARE USED FOR PORTION OF TRAVEL. WHEN MORE THAN',
						'          ONE FARE COMPONENTS IS BEING CHANGED THE HIGHEST',
						'          OF PENALTIES OF ALL CHANGED FARE COMPONENTS WILL',
						'          APPLY.',
						'          -------------------------------',
						'          CHANGE OF FARE BREAK POINT PERMITTED - TICKET MUST',
						'                                                  PAGE  2/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          BE EXCHANGED MANUALLY.',
						'          -------------------------------',
						'                // IN THE EVENT OF NO SHOW //',
						'            WHEN CHANGES ARE REQUESTED AFTER DEPARTURE',
						'            OF THE ORIGINALLY SCHEDULED FLIGHT',
						'          - WHOLE TICKET MUST BE RECALCULATED FROM THE POINT',
						'          OF ORIGIN AND FARE ON A FARE COMPONENT PASSENEGER',
						'          IS NO SHOW MUST BE UPGRADED TO ANY HIGHER -RED',
						'          OR -PMLO OR FULL BUSINESS INTERNATIONAL',
						'          FARES /EXCLUDING BOX AND BX FARE TYPE CODES/ AND',
						'          PASSENEGER PAYS THE DIFFERENCE IN FARES.',
						'          OR',
						'           - TICKET MUST BE REFUNDED - CANCELLATION RULES',
						'          APPLIES.',
						'                                                  PAGE  3/ 3',
						' ',
					]),
				},
				{
					'cmd': 'FQN3*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN3*16',
						'',
						'3 - PTC 4 IN',
						' FQN 3-1    INF KIVRIX SU  YFO               FF : EF',
						' FQN 3-2    INF RIXTYO LO  Y1RED',
						'                                                  PAGE  1/ 1',
						' ',
					]),
				},
				{
					'cmd': 'FQN3-1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN3-1*16',
						'',
						' 3 - PTC 4 IN                                      RULES DISPLAY',
						'FARE COMPONENT  1    INF KIVRIX SU  YFO',
						'FCL: YFO       TRF:  21 RULE: EF01 BK:  Y',
						'PTC: INF-INFANT NOT OCCUPYI FTC: EU -ECONOMY UNRESTRICTED',
						'FARE FAMILY            : EF',
						'PE.PENALTIES',
						'FOR ECONOMY UNRESTRICTED FARES',
						'',
						'',
						'         NOTE -',
						'          // CANCELLATION PROVISIONS //',
						'          ---',
						'          CHARGE APPLY PER TRANSACTIONS.',
						'          CHILD DISCOUNT DOES NOT APPLY.',
						'          INFANT WITHOUT A SEAT FREE OF CHARGE.',
						'          ---',
						'          ONLY FARE IN SAME BRAND CAN BE USED FOR REFUND',
						'          PROCEDURE OF PARTLY USED TICKET.',
						'          FARES DIVIDED INTO BRANDS BY FOLLOWING -',
						'                                                  PAGE  1/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          PROMO - FARES WITH PREFIX -SX/-SO',
						'          BUDGET/SAVER - FARES WITH PREFIX -VU/-VO',
						'          OPTIMUM/CLASSIC - FARES WITH PREFIX -CL/-CO',
						'          PREMIUM/FLEX - FARES WITH PREFIX -FM/-FO',
						'          //',
						'          WHEN COMBINING ON A HALF ROUNDTRIP BASIS THE',
						'          MOST RESTRICTIVE CANCELLATION CONDITION APPLIES',
						'          FOR THE ENTIRE PRICING UNIT.',
						'          ---',
						'          PENALTIES WAIVED IN CASE OF INVOLUNTARY REFUND.',
						'          CONTACT CARRIER FOR DETAILS.',
						'          ---',
						'          REFUND OF UNUSED FEES AND TAXES PERMITTED DURING',
						'          TICKET VALIDITY PERIOD.',
						'          ---',
						'          PAPER TICKET SURCHARGE IS NOT REFUNDABLE WHEN',
						'          APPLIED.',
						'          ---',
						'          IN CASE OF CANCELLATION AFTER DEPARTURE REFUND',
						'          THE DIFFERENCE BETWEEN THE FARE PAID AND THE',
						'          APPLICABLE FARE FLOWN.',
						'                                                  PAGE  2/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          WHEN REPRICING FARES FOR FLOWN ITINERARY FARES IN',
						'          LOWER RBD THAN SHOWN IN USED COUPONS CANNOT APPLY.',
						'          ---',
						'          REFUND CAN ONLY BE MADE THROUGH ISSUING OFFICE.',
						'          ---',
						'          // CHANGES PROVISIONS //',
						'          ---',
						'          CHARGE APPLY PER TRANSACTION.',
						'          CHILD DISCOUNT APPLY.',
						'          INFANT WITHOUT A SEAT FREE OF CHARGE.',
						'          CHANGE PERMITTED ONLY WITHIN SAME BRAND.',
						'          FARES DIVIDED INTO BRANDS BY FOLLOWING -',
						'          PROMO - FARES WITH PREFIX -SX/-SO',
						'          BUDGET/SAVER - FARES WITH PREFIX -VU/-VO',
						'          OPTIMUM/CLASSIC - FARES WITH PREFIX -CL/-CO',
						'          PREMIUM/FLEX - FARES WITH PREFIX -FM/-FO',
						'          //',
						'          ---',
						'          CHANGE IS A ROUTING/DATE/FLIGHT/BOOKING CLASS/FARE',
						'          MODIFICATION.',
						'          ---',
						'                                                  PAGE  3/ 4',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          RULES FOR CHANGES APPLY BY FARE',
						'          COMPONENT/DIRECTION.',
						'          IN CASE OF FARE COMBINATION CHARGE THE HIGHEST',
						'          FEE OF ALL CHANGED FARE COMPONENTS.',
						'          ---',
						'          NEW FARE AMOUNT SHOULD BE EQUAL OR HIGHER THAN',
						'          PREVIOUS AMOUNT.',
						'          ---',
						'          WHEN COMBINING NORMAL FARE WITH SPECIAL FARE ON A',
						'          HALF ROUNDTRIP BASIS NEW FARE AMOUNT SHOULD BE',
						'          EQUAL OR HIGHER THAN THE PREVIOUS AMOUNT.',
						'          FOR THE ITINERARIES WHERE JFM/JFO/WFM/WFO/YFM/YFO',
						'          FARES APPLIED TO THE ENTIRE ITINERARY',
						'          DOWNGRAIDING IS PERMITTED ONLY TO ABOVE MENTIONED',
						'          FARES.',
						'                                                  PAGE  4/ 4',
						' ',
					]),
				},
				{
					'cmd': 'FQN3-2*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN3-2*16',
						'',
						' 3 - PTC 4 IN                                      RULES DISPLAY',
						'FARE COMPONENT  2    INF RIXTYO LO  Y1RED',
						'FCL: Y1RED     TRF:  44 RULE: JP05 BK:  Y',
						'PTC: INF-INFANT NOT OCCUPYI FTC: EU -ECONOMY UNRESTRICTED',
						'PE.PENALTIES',
						'',
						'  CANCELLATIONS',
						'',
						'    BEFORE DEPARTURE',
						'      CANCELLATIONS PERMITTED.',
						'',
						'    AFTER DEPARTURE',
						'      CANCELLATIONS PERMITTED.',
						'',
						'  CHANGES',
						'',
						'    CHANGES PERMITTED FOR REISSUE/REVALIDATION.',
						'         NOTE -',
						'          CHARGE APPLIES PER TRANSACTION.',
						'                                                  PAGE  1/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          ------------------------------------',
						'          REBOOKING/REISSUE IS A ROUTING/DATE/FARE BASIS/',
						'          FLIGHT MODIFICATION.',
						'          WHEN MORE THAN ONE FARE COMPONENTS IS BEING',
						'          CHANGED THE HIGHEST OF PENALTIES OF ALL CHANGED',
						'          FARE COMPONENTS WILL APPLY.',
						'          ------------------------------------',
						'          FARE CAN BE REISSUED TO OTHER INTERNATIONAL FARES',
						'          THAT ARE EQUAL OR HIGHER THAN THE ORIGINAL FARES.',
						'          ALL CONDITIONS OF THE NEW FARE MUST BE MET',
						'          AND PASSENGER PAYS THE DIFFERENCE IN FARE PLUS',
						'          CHANGE OF RESERVATION FEE IF ANY APPLIES.',
						'          -----------------------------',
						'          IN CASE OF FARE COMBINATIONS PENALTY APPLIES PER',
						'          FARE COMPONENT ACCORDING TO RESTRICTIONS OF',
						'          FARE USED FOR PORTION OF TRAVEL. WHEN MORE THAN',
						'          ONE FARE COMPONENTS IS BEING CHANGED THE HIGHEST',
						'          OF PENALTIES OF ALL CHANGED FARE COMPONENTS WILL',
						'          APPLY.',
						'          -------------------------------',
						'          CHANGE OF FARE BREAK POINT PERMITTED - TICKET MUST',
						'                                                  PAGE  2/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          BE EXCHANGED MANUALLY.',
						'          -------------------------------',
						'                // IN THE EVENT OF NO SHOW //',
						'            WHEN CHANGES ARE REQUESTED AFTER DEPARTURE',
						'            OF THE ORIGINALLY SCHEDULED FLIGHT',
						'          - WHOLE TICKET MUST BE RECALCULATED FROM THE POINT',
						'          OF ORIGIN AND FARE ON A FARE COMPONENT PASSENEGER',
						'          IS NO SHOW MUST BE UPGRADED TO ANY HIGHER -RED',
						'          OR -PMLO OR FULL BUSINESS INTERNATIONAL',
						'          FARES /EXCLUDING BOX AND BX FARE TYPE CODES/ AND',
						'          PASSENEGER PAYS THE DIFFERENCE IN FARES.',
						'          OR',
						'           - TICKET MUST BE REFUNDED - CANCELLATION RULES',
						'          APPLIES.',
						'                                                  PAGE  3/ 3',
						' ',
					])
				},
			],
		});

		// reproducing a case where itinerary is empty for some reason
		// it happened due to RT flight number being "023", but SVC flight
		// number being just "23" - they did not match and caused an error
		$list.push({
			'input': {
				'useStatefulRules': true,
				'previousCommands': [
					{
						'cmd': 'FXR',
						'output': php.implode(php.PHP_EOL, [
							'FXR',
							'',
							'01 P1',
							'ITINERARY REBOOKED',
							'LAST TKT DTE 25SEP17 - DATE OF ORIGIN',
							'------------------------------------------------------------',
							'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
							' SEA',
							'XTPE BR    23 W *  25SEP 1130  WLX6ER          25SEP25SEP 2P',
							' MNL BR   261 W *  26SEP 2030  WLX6ER          26SEP26SEP 2P',
							'XTPE BR   272 W *  15OCT 1240  WLW6R           27SEP25MAR 2P',
							' SEA BR    26 W *  15OCT 2340  WLW6R           27SEP25MAR 2P',
							'',
							'USD   550.00      25SEP17SEA BR X/TPE BR MNL227.50WLX6ER BR',
							'                  X/TPE BR SEA322.50WLW6R NUC550.00END ROE',
							'USD    66.00YQ    1.000000',
							'USD     5.50YC    XT USD 18.00US USD 18.00US USD 3.96XA USD',
							'USD    67.82XT    7.00XY USD 5.60AY USD 10.76LI USD 4.50XF',
							'USD   689.32      SEA4.50',
							'ANCILLARY SERVICES AT A CHARGE MAY BE AVAILABLE-ENTER FXK',
							'TICKET STOCK RESTRICTION',
							'                                                  PAGE  2/ 3',
							' ',
						]),
					},
				],
			},
			'output': {
				'allCommands': [
					{'cmd': 'RT', 'type': 'redisplayPnr'},
					{'cmd': 'FXR', 'type': 'priceItinerary'},
					{'cmd': 'DO1-4', 'type': 'flightServiceInfo'},
					{'cmd': 'FQN1*16', 'type': 'fareList'},
					{'cmd': 'FQN1-1*16', 'type': 'fareList'},
					{'cmd': 'FQN1-2*16', 'type': 'fareList'},
				],
				'pnrData': {
					'reservation': {
						'parsed': {
							'itinerary': [
								{
									'flightNumber': '023',
									'destinationAirport': 'TPE',
								},
								{
									'flightNumber': '261',
									'destinationAirport': 'MNL',
								},
								{
									'flightNumber': '272',
									'destinationAirport': 'TPE',
								},
								{
									'flightNumber': '026',
									'destinationAirport': 'SEA',
								},
							],
						},
					},
					'flightServiceInfo': {
						'parsed': {
							'segments': [
								{
									'flightNumber': '23',
									'legs': [
										{'aircraft': '77W', 'flightDuration': '12:40'},
									],
								},
								{
									'flightNumber': '261',
									'legs': [
										{'aircraft': '321', 'flightDuration': '2:20'},
									],
								},
								{
									'flightNumber': '272',
									'legs': [
										{'aircraft': '77W', 'flightDuration': '2:15'},
									],
								},
								{
									'flightNumber': '26',
									'legs': [
										{'aircraft': '77W', 'flightDuration': '10:50'},
									],
								},
							],
						},
					},
					'currentPricing': {
						'cmd': 'FXR',
						'parsed': {
							'pricingList': [
								{
									'pricingBlockList': [
										{
											'ptcInfo': {'ptc': 'ADT', 'quantity': 1},
											'validatingCarrier': 'BR',
											'fareInfo': {
												'baseFare': {'currency': 'USD', 'amount': '550.00'},
												'totalFare': {'currency': 'USD', 'amount': '689.32'},
												'fareConstruction': {
													'fare': '550.00',
												},
											},
										},
									],
								},
							],
						},
					},
					'fareRules': [
						{
							'subPricingNumber': 1,
							'fareComponentNumber': '1',
							'sections': {
								'exchange': {
									'parsed': [
										{
											'conditions': [],
											'penalties': [
												{
													'actionName': 'cancellations',
													'prices': [
														{
															'violations': ['cancel', 'refund'],
															'fareCurrency': 'USD',
															'fareAmount': '100.00',
														},
													],
												},
											],
										},
										{
											'conditions': ['OUTBOUND -'],
											'penalties': [
												{
													'actionName': 'changes',
													'prices': [
														{
															'violations': ['reissue'],
															'fareCurrency': 'USD',
															'fareAmount': '50.00',
														},
													],
												},
											],
										},
										{
											'conditions': ['INBOUND -'],
											'penalties': [
												{
													'actionName': 'changes',
													'prices': [
														{
															'violations': ['reissue', 'revalidation'],
															'isPermitted': true,
														},
													],
												},
											],
										},
										{
											'conditions': [
												'*** GENERAL RULE FOLLOWS ***',
												'FROM/TO THE UNITED STATES',
											],
											'penalties': [
												{
													'actionName': 'cancellations',
													'prices': [
														{
															'violations': ['lostTicket'],
															'fareCurrency': 'USD',
															'fareAmount': '50.00',
														},
													],
												},
											],
										},
									],
								},
							},
						},
						{
							'subPricingNumber': 1,
							'fareComponentNumber': '2',
							'sections': {
								'exchange': [
									// ... same rules as in first component ...
								],
							},
						},
					],
				},
			},
			'calledCommands': [
				{
					'cmd': 'RT',
					'output': php.implode(php.PHP_EOL, [
						'/$--- MSC SFP ---',
						'RP/SFO1S2195/',
						'  1  BR 023 W 25SEP 1*SEATPE DK1  1130A 310P 26SEP  E  0 77W M',
						'     SEE RTSVC',
						'  2  BR 261 W 26SEP 2*TPEMNL DK1   830P1050P 26SEP  E  0 321 M',
						'     SEE RTSVC',
						'  3  BR 272 W 15OCT 7*MNLTPE DK1  1240P 255P 15OCT  E  0 77W M',
						'     SEE RTSVC',
						'  4  BR 026 W 15OCT 7*TPESEA DK1  1140P 730P 15OCT  E  0 77W M',
						'     SEE RTSVC',
						'  5 RM NOTIFY PASSENGER PRIOR TO TICKET PURCHASE & CHECK-IN:',
						'       FEDERAL LAWS FORBID THE CARRIAGE OF HAZARDOUS MATERIALS -',
						'       GGAMAUSHAZ/S1,4',
						' ',
					]),
				},
				{
					'cmd': 'MBFXB',
					'output': php.implode(php.PHP_EOL, [
						'BG CXR: BR',
						'PRICED WITH VALIDATING CARRIER BR - REPRICE IF DIFFERENT VC',
						'FARE VALID FOR E TICKET ONLY',
						'100.00 USD PENALTY APPLIES',
						'ENDOS /C1-4 NON END/RRT/NO STPVR /BR/B7 EWA APLY /FLT RESTR',
						'      APLY -BG:BR',
						'04SEP17 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
						'                                                  PAGE  3/ 3',
						' ',
					]),
				},
				{
					'cmd': 'DO1-4',
					'output': php.implode(php.PHP_EOL, [
						'/$DO1-4',
						'*1A PLANNED FLIGHT INFO*              BR  23   21 MO 25SEP17    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'SEA          1130  MO CJDKLTPYBMH/M       77W        12:40      ',
						'                      QSWV/M                                    ',
						'TPE 1510  TU                                               12:40',
						'',
						'COMMENTS-',
						' 1.SEA TPE   - MEMBER OF *A                                     ',
						' 2.SEA TPE   - ARRIVES TERMINAL 2                               ',
						' 3.SEA TPE   - MCT FLIGHT TRACKING I/I                          ',
						' 4.SEA TPE   -   1/ MOVIE                                       ',
						' 5.SEA TPE   -   2/ TELEPHONE                                   ',
						' 6.SEA TPE   -   3/ ENTERTAINMENT ON DEMAND                     ',
						' 7.SEA TPE   -   4/ AUDIO PROGRAMMING                           ',
						' 8.SEA TPE   -   7/ DUTY FREE SALES                             ',
						' 9.SEA TPE   -   9/ NON-SMOKING                                 ',
						'10.SEA TPE   -  10/ SHORT FEATURE VIDEO                         ',
						'11.SEA TPE   -  15/ IN-SEAT VIDEO PLAYER/LIBRARY                ',
						'12.SEA TPE   -  18/ WI-FI                                       ',
						'13.SEA TPE   -  20/ LIE-FLAT SEAT BUSINESS                      ',
						'14.SEA TPE   -  22/ 110V AC POWER                               ',
						'15.SEA TPE   -  27/ USB POWER                                   ',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$16.SEA TPE   - SECURED FLIGHT                                   ',
						'17.SEA TPE   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						'18.SEA TPE   - C38K64Y221                                       ',
						'19.SEA TPE   -  CO2/PAX* 403.03 KG ECO, 806.06 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               77W  C  38   K  64   Y 221                       ',
						'*1A PLANNED FLIGHT INFO*              BR 261   22 TU 26SEP17    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'TPE          2030  TU CJDYBMHQSWV/M       321         2:20      ',
						'MNL 2250  TU                                                2:20',
						'',
						'COMMENTS-',
						' 1.TPE MNL   - MEMBER OF *A                                     ',
						' 2.TPE MNL   - DEPARTS TERMINAL 2                               ',
						' 3.TPE MNL   - ARRIVES TERMINAL 1                               ',
						' 4.TPE MNL   - MCT FLIGHT TRACKING I/I                          ',
						' 5.TPE MNL   -   1/ MOVIE                                       ',
						' 6.TPE MNL   -   4/ AUDIO PROGRAMMING                           ',
						' 7.TPE MNL   -   7/ DUTY FREE SALES                             ',
						' 8.TPE MNL   -   9/ NON-SMOKING                                 ',
						' 9.TPE MNL   -  10/ SHORT FEATURE VIDEO                         ',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$10.TPE MNL   -  24/ 110V AC POWER BUSINESS                      ',
						'11.TPE MNL   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						'12.TPE MNL   - C8Y176                                           ',
						'13.TPE MNL   -  CO2/PAX* 99.25 KG ECO, 99.25 KG PRE             ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               321  C   8   Y 176                               ',
						'*1A PLANNED FLIGHT INFO*              BR 272   41 SU 15OCT17    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'MNL          1240  SU CJDYBMHQSWV/M       77W         2:15      ',
						'TPE 1455  SU                                                2:15',
						'',
						'COMMENTS-',
						' 1.MNL TPE   - MEMBER OF *A                                     ',
						' 2.MNL TPE   - DEPARTS TERMINAL 1                               ',
						' 3.MNL TPE   - ARRIVES TERMINAL 2                               ',
						' 4.MNL TPE   - MCT FLIGHT TRACKING I/I                          ',
						' 5.MNL TPE   -   1/ MOVIE                                       ',
						' 6.MNL TPE   -   2/ TELEPHONE                                   ',
						' 7.MNL TPE   -   3/ ENTERTAINMENT ON DEMAND                     ',
						' 8.MNL TPE   -   4/ AUDIO PROGRAMMING                           ',
						' 9.MNL TPE   -   7/ DUTY FREE SALES                             ',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$10.MNL TPE   -   9/ NON-SMOKING                                 ',
						'11.MNL TPE   -  10/ SHORT FEATURE VIDEO                         ',
						'12.MNL TPE   -  15/ IN-SEAT VIDEO PLAYER/LIBRARY                ',
						'13.MNL TPE   -  18/ WI-FI                                       ',
						'14.MNL TPE   -  20/ LIE-FLAT SEAT BUSINESS                      ',
						'15.MNL TPE   -  22/ 110V AC POWER                               ',
						'16.MNL TPE   -  27/ USB POWER                                   ',
						'17.MNL TPE   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						'18.MNL TPE   - C38Y285                                          ',
						'19.MNL TPE   -  CO2/PAX* 99.26 KG ECO, 99.26 KG PRE             ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               77W  C  38   Y 285                               ',
						'*1A PLANNED FLIGHT INFO*              BR  26   41 SU 15OCT17    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'TPE          2340  SU CJDKLTPYBMH/M       77W        10:50      ',
						'                      QSWV/M                                    ',
						'SEA 1930  SU                                               10:50',
						'',
						'COMMENTS-',
						' 1.TPE SEA   - MEMBER OF *A                                     ',
						' 2.TPE SEA   - DEPARTS TERMINAL 2                               ',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$ 3.TPE SEA   - MCT FLIGHT TRACKING I/I                          ',
						' 4.TPE SEA   -   1/ MOVIE                                       ',
						' 5.TPE SEA   -   2/ TELEPHONE                                   ',
						' 6.TPE SEA   -   3/ ENTERTAINMENT ON DEMAND                     ',
						' 7.TPE SEA   -   4/ AUDIO PROGRAMMING                           ',
						' 8.TPE SEA   -   7/ DUTY FREE SALES                             ',
						' 9.TPE SEA   -   9/ NON-SMOKING                                 ',
						'10.TPE SEA   -  10/ SHORT FEATURE VIDEO                         ',
						'11.TPE SEA   -  15/ IN-SEAT VIDEO PLAYER/LIBRARY                ',
						'12.TPE SEA   -  18/ WI-FI                                       ',
						'13.TPE SEA   -  20/ LIE-FLAT SEAT BUSINESS                      ',
						'14.TPE SEA   -  22/ 110V AC POWER                               ',
						'15.TPE SEA   -  27/ USB POWER                                   ',
						'16.TPE SEA   - SECURED FLIGHT                                   ',
						'17.TPE SEA   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						'18.TPE SEA   - C39K56Y258                                       ',
						'19.TPE SEA   -  CO2/PAX* 403.03 KG ECO, 806.06 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               77W  C  39   K  56   Y 258                       ',
						' ',
					]),
				},
				{
					'cmd': 'FQN1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1*16',
						'',
						'1 - PSGR P1 ADT',
						' FQN 1-1    ADT SEAMNL BR  WLX6ER',
						' FQN 1-2    ADT MNLSEA BR  WLW6R',
						'                                                  PAGE  1/ 1',
						' ',
					]),
				},
				{
					'cmd': 'FQN1-1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1-1*16',
						'',
						' 1 - PSGR P1 ADT                                   RULES DISPLAY',
						'FARE COMPONENT  1    ADT SEAMNL BR  WLX6ER',
						'FCL: WLX6ER    TRF:   3 RULE: 8900 BK:  W',
						'PTC: ADT-ADULT              FTC: XPF-INSTANT PURCHASE 4TH LVL',
						'PE.PENALTIES',
						'',
						'  CANCELLATIONS',
						'',
						'    ANY TIME',
						'      PER TICKET CHARGE USD 100.00 FOR CANCEL/REFUND.',
						'      CHILD/INFANT DISCOUNTS APPLY.',
						'         NOTE -',
						'          1- PARTIAL REFUND//CALCULATE DIFFERENCE BETWEEN',
						'             FARE PAID AND QUALIFYING FARE FOR FULLY FLOWN',
						'             PORTION USING FARES IN EFFECT WHEN TICKET WAS',
						'             ISSUED / LESS CANCELLATION/REFUND PENALTY.',
						'          2- WHEN THE NEW ITINERARY RESULTS A LOWER FARE.',
						'             NO REFUND OF THE FARE DIFFERENCE WILL BE MADE',
						'             TO REBOOK / REROUTE / REVALIDATE / REISSUE.',
						'                                                  PAGE  1/ 5',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          3- WHEN EACH HALF ROUND-TRIP OR EACH PRICING UNIT',
						'             IS GOVERNED BY ITS OWN PENALTY / THE HIGHEST',
						'             PENALTY THAT GOVERNS THE TRANSPACIFIC SECTOR',
						'             APPLIES TO THE ENTIRED BR FARE COMPONENTS OF',
						'             THE TICKETED ITINERARY. THE PENALTY ESTABLISHED',
						'             FOR OTHER AIRLINES IF ANY / SHALL CONTINUE TO',
						'             APPLY FOR OAL PORTION OF THE TICKETED FARE',
						'             COMPONENT.',
						'',
						'  OUTBOUND -',
						'    CHANGES',
						'',
						'      ANY TIME',
						'        CHARGE USD 50.00 FOR REISSUE.',
						'        CHILD/INFANT DISCOUNTS APPLY.',
						'',
						'  INBOUND -',
						'    CHANGES',
						'',
						'      ANY TIME',
						'        CHANGES PERMITTED FOR REISSUE/REVALIDATION.',
						'                                                  PAGE  2/ 5',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'         NOTE -',
						'          1. NO CHARGE FOR REVALIDATION',
						'          2. NO CHARGE FOR REISSUE',
						'              - CHANGE DATE/FLIGHT ONLY PROVIDED NO CHANGE',
						'                TO TICKETED POINT/ STOPOVER/ FARE BASIS.',
						'          3. CHARGE USD50.00 FOR REISSUE',
						'              - OTHER CHANGES',
						'                CHILD/INFANT DISCOUNTS APPLY',
						'',
						'         NOTE -',
						'          GENERAL RULE -',
						'          1- CHANGE MUST BE MADE WITHIN TICKET VALIDITY.',
						'          2- CHANGE OF AIRPORT WITHIN ONE CITY DOES NOT',
						'             CONSTITUTE TICKETED POINT CHANGED.',
						'          3- WHEN THE NEW ITINERARY RESULTS IN A HIGHER',
						'             FARE- COLLECT FARE DIFFERENCE AND CHANGE FEE IF',
						'             APPLICABLE.',
						'             WHEN THE NEW ITINERARY RESULTS IN A LOWER',
						'             FARE- NO REFUNDS WILL BE MADE AND COLLECT',
						'             CHANGE FEE IF APPLICABLE /BY MANUALLY',
						'             REISSUANCE ONLY/.',
						'                                                  PAGE  3/ 5',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          4- IF CHANGE TO 1ST FLIGHT COUPON-',
						'             USE CURRENT BR/B7 PUBLIC FARES GOVERNED BY',
						'             SAME RULE OR',
						'             USE CURRENT BR/B7 PUBLIC FARES GOVERNED BY',
						'             RULE 8900 FOR RE-PRICE.',
						'             MEASURE ADVANCE PURCHASE FROM TICKET REISSUE',
						'             DATE.',
						'          5- IF NO CHANGE TO 1ST FLIGHT COUPON-',
						'             USE HISTORICAL BR/B7 PUBLIC FARES GOVERNED BY',
						'             SAME RULE OR',
						'             USE HISTORICAL BR/B7 PUBLIC FARES GOVERNED BY',
						'             RULE 8900 FOR RE-PRICE.',
						'          6- CHARGE THE HIGHEST CHANGE FEE OF ALL CHANGED',
						'             FARE COMPONENT PER TICKET.',
						'          7- THE CHARGE FEE APPLIES PER REISSUANCE PER',
						'             PERSON.',
						'          8- FARE DIFFERENCE AND CHANGE FEE MUST BE PAID AND',
						'             TICKETS MUST BE REISSUED AT SAME TIME WHEN',
						'             VOLUNTARY CHANGES IS CONFIRMED.',
						'  *** GENERAL RULE FOLLOWS ***',
						'FROM/TO THE UNITED STATES',
						'                                                  PAGE  4/ 5',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'',
						'  CANCELLATIONS',
						'',
						'    CHARGE USD 50.00 FOR LOST TICKET.',
						'                                                  PAGE  5/ 5',
						' ',
					]),
				},
				{
					'cmd': 'FQN1-2*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1-2*16',
						'',
						' 1 - PSGR P1 ADT                                   RULES DISPLAY',
						'FARE COMPONENT  2    ADT MNLSEA BR  WLW6R',
						'FCL: WLW6R     TRF:   3 RULE: 8900 BK:  W',
						'PTC: ADT-ADULT              FTC: XPF-INSTANT PURCHASE 4TH LVL',
						'PE.PENALTIES',
						'',
						'  CANCELLATIONS',
						'',
						'    ANY TIME',
						'      PER TICKET CHARGE USD 100.00 FOR CANCEL/REFUND.',
						'      CHILD/INFANT DISCOUNTS APPLY.',
						'         NOTE -',
						'          1- PARTIAL REFUND//CALCULATE DIFFERENCE BETWEEN',
						'             FARE PAID AND QUALIFYING FARE FOR FULLY FLOWN',
						'             PORTION USING FARES IN EFFECT WHEN TICKET WAS',
						'             ISSUED / LESS CANCELLATION/REFUND PENALTY.',
						'          2- WHEN THE NEW ITINERARY RESULTS A LOWER FARE.',
						'             NO REFUND OF THE FARE DIFFERENCE WILL BE MADE',
						'             TO REBOOK / REROUTE / REVALIDATE / REISSUE.',
						'                                                  PAGE  1/ 5',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          3- WHEN EACH HALF ROUND-TRIP OR EACH PRICING UNIT',
						'             IS GOVERNED BY ITS OWN PENALTY / THE HIGHEST',
						'             PENALTY THAT GOVERNS THE TRANSPACIFIC SECTOR',
						'             APPLIES TO THE ENTIRED BR FARE COMPONENTS OF',
						'             THE TICKETED ITINERARY. THE PENALTY ESTABLISHED',
						'             FOR OTHER AIRLINES IF ANY / SHALL CONTINUE TO',
						'             APPLY FOR OAL PORTION OF THE TICKETED FARE',
						'             COMPONENT.',
						'',
						'  OUTBOUND -',
						'    CHANGES',
						'',
						'      ANY TIME',
						'        CHARGE USD 50.00 FOR REISSUE.',
						'        CHILD/INFANT DISCOUNTS APPLY.',
						'',
						'  INBOUND -',
						'    CHANGES',
						'',
						'      ANY TIME',
						'        CHANGES PERMITTED FOR REISSUE/REVALIDATION.',
						'                                                  PAGE  2/ 5',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'         NOTE -',
						'          1. NO CHARGE FOR REVALIDATION',
						'          2. NO CHARGE FOR REISSUE',
						'              - CHANGE DATE/FLIGHT ONLY PROVIDED NO CHANGE',
						'                TO TICKETED POINT/ STOPOVER/ FARE BASIS.',
						'          3. CHARGE USD50.00 FOR REISSUE',
						'              - OTHER CHANGES',
						'                CHILD/INFANT DISCOUNTS APPLY',
						'',
						'         NOTE -',
						'          GENERAL RULE -',
						'          1- CHANGE MUST BE MADE WITHIN TICKET VALIDITY.',
						'          2- CHANGE OF AIRPORT WITHIN ONE CITY DOES NOT',
						'             CONSTITUTE TICKETED POINT CHANGED.',
						'          3- WHEN THE NEW ITINERARY RESULTS IN A HIGHER',
						'             FARE- COLLECT FARE DIFFERENCE AND CHANGE FEE IF',
						'             APPLICABLE.',
						'             WHEN THE NEW ITINERARY RESULTS IN A LOWER',
						'             FARE- NO REFUNDS WILL BE MADE AND COLLECT',
						'             CHANGE FEE IF APPLICABLE /BY MANUALLY',
						'             REISSUANCE ONLY/.',
						'                                                  PAGE  3/ 5',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          4- IF CHANGE TO 1ST FLIGHT COUPON-',
						'             USE CURRENT BR/B7 PUBLIC FARES GOVERNED BY',
						'             SAME RULE OR',
						'             USE CURRENT BR/B7 PUBLIC FARES GOVERNED BY',
						'             RULE 8900 FOR RE-PRICE.',
						'             MEASURE ADVANCE PURCHASE FROM TICKET REISSUE',
						'             DATE.',
						'          5- IF NO CHANGE TO 1ST FLIGHT COUPON-',
						'             USE HISTORICAL BR/B7 PUBLIC FARES GOVERNED BY',
						'             SAME RULE OR',
						'             USE HISTORICAL BR/B7 PUBLIC FARES GOVERNED BY',
						'             RULE 8900 FOR RE-PRICE.',
						'          6- CHARGE THE HIGHEST CHANGE FEE OF ALL CHANGED',
						'             FARE COMPONENT PER TICKET.',
						'          7- THE CHARGE FEE APPLIES PER REISSUANCE PER',
						'             PERSON.',
						'          8- FARE DIFFERENCE AND CHANGE FEE MUST BE PAID AND',
						'             TICKETS MUST BE REISSUED AT SAME TIME WHEN',
						'             VOLUNTARY CHANGES IS CONFIRMED.',
						'  *** GENERAL RULE FOLLOWS ***',
						'FROM/TO THE UNITED STATES',
						'                                                  PAGE  4/ 5',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'',
						'  CANCELLATIONS',
						'',
						'    CHARGE USD 50.00 FOR LOST TICKET.',
						'                                                  PAGE  5/ 5',
						' ',
					]),
				},
			],
		});

		// Due to a bug if some MDR in state safe commands did not have the
		// original command, we returned the MDR as full output without checking
		// that it belongs to the command we are actually searching for
		// that should not happen anymore
		$list.push({
			'input': {
				'useStatefulRules': true,
				'leadData': [],
				'previousCommands': [
					{
						'cmd': 'FXX',
						'output': php.implode(php.PHP_EOL, [
							'FXX',
							'',
							'01 WILLIAMS/JESSI*',
							'',
							'LAST TKT DTE 31JAN18 - SEE SALES RSTNS',
							'------------------------------------------------------------',
							'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
							' SEA',
							'XWAS LH  7485 K    15MAR 0815  KLNC34N         15MAR15MAR 1P',
							' FRA LH  9051 K    15MAR 1825  KLNC34N         15MAR15MAR 1P',
							' SEA UA  8717 L    27MAR 1045  LLNC14N         27MAR27MAR 1P',
							'',
							'USD   368.00      15MAR18SEA LH X/WAS LH FRA124.00KLNC34N UA',
							'                  SEA244.00LLNC14N NUC368.00END ROE1.000000',
							'USD   275.00YQ    XT USD 5.65YC USD 18.30US USD 18.30US USD',
							'USD    17.50YR    3.96XA USD 7.00XY USD 5.60AY USD 52.18OY',
							'USD   172.81XT    USD 11.19DE USD 41.63RA USD 9.00XF SEA4.50',
							'USD   833.31      IAD4.50',
							'BAG/OTHER SERVICES AT A CHARGE MAY BE AVAILABLE-ENTER FXK',
							'TICKET STOCK RESTRICTION',
							'BG CXR: LH',
							'                                                  PAGE  2/ 3',
							' ',
						]),
					},
					{
						'cmd': 'RT',
						'output': php.implode(php.PHP_EOL, [
							'/$--- TST RLR MSC SFP ---',
							'RP/SFO1S2195/SFO1S2195            FT/RC  30JAN18/1218Z   WY7TB3',
							'------- PRIORITY',
							'M  CREATED IN GDS DIRECT BY KIRA',
							'-------',
							'SFO1S2195/9998WS/30JAN18',
							'  1.WILLIAMS/JESSICA ANN',
							'  2  LH7485 K 15MAR 4*SEAIAD HK1   815A 411P 15MAR  E  LH/WY7TB3',
							'  3  LH9051 K 15MAR 4*IADFRA HK1   625P 710A 16MAR  E  LH/WY7TB3',
							'  4  UA8717 L 27MAR 2 FRASEA HK1  1045A1155A 27MAR  E  UA/D7SPJQ',
							'  5 AP SFO 888 585-2727 - ITN CORP. - A',
							'  6 TK TL30JAN/SFO1S2195',
							'  7 SSR ADTK 1A KK1 .TKT UA SEGS BY 02FEB18 TO AVOID AUTO CXL',
							'       /EARLIER',
							'  8 SSR ADTK 1A KK1 .TICKETING MAY BE REQUIRED BY FARE RULE',
							'  9 SSR OTHS 1A PLS ISS AUTOMATIC TKT BY 02FEB18/2359Z OR LH',
							'       OPTG/MKTG SEGS WILL BE XLD. APPLIC FARE RULE APPLIES IF',
							'       IT',
							' 10 SSR OTHS 1A ///DEMANDS EARLIER TKTG.',
							' 11 OSI LH CTCP SFO888 585-2727 ITN CORP. - A',
							' 12 OSI LH CTCT SFO888 585-2727 ITN CORP.',
							' 13 RM GD-KIRA/785/FOR KIRA/785/LEAD-5503486 IN SFO1S2195',
							') ',
						]),
					},
					{
						'cmd': 'MDR',
						'output': php.implode(php.PHP_EOL, [
							'/$ 14 RM NOTIFY PASSENGER PRIOR TO TICKET PURCHASE & CHECK-IN:',
							'       FEDERAL LAWS FORBID THE CARRIAGE OF HAZARDOUS MATERIALS -',
							'       GGAMAUSHAZ/S2-4',
							' 15 FE PAX NONREF/0VALUAFTDPT/CHGFEE -BG:LH/S2-4',
							' 16 FV PAX LH/S2-4',
							' ',
						]),
					},
					{
						'cmd': 'MBFXP',
						'output': php.implode(php.PHP_EOL, [
							'PRICED WITH VALIDATING CARRIER LH - REPRICE IF DIFFERENT VC',
							'TICKETS ARE NON-REFUNDABLE',
							'ENDOS NONREF/0VALUAFTDPT/CHGFEE -BG:LH',
							'30JAN18 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
							'                                                  PAGE  3/ 3',
							' ',
						]),
					},
				],
			},
			'output': {
				'pnrData': {
					'reservation': {
						'parsed': {
							'itinerary': [
								{'airline': 'LH', 'flightNumber': '7485'},
								{'airline': 'LH', 'flightNumber': '9051'},
								{'airline': 'UA', 'flightNumber': '8717'},
							],
						},
					},
					'flightServiceInfo': {
						'parsed': {
							'segments': [
								{
									'legs': [
										{
											'departureAirport': 'SEA',
											'destinationAirport': 'IAD',
											'aircraft': '739',
											'flightDuration': '4:56',
										},
									],
								},
							],
						},
					},
				},
			},
			'calledCommands': [
				{
					'cmd': 'DO2-4',
					'output': php.implode(php.PHP_EOL, [
						'/$DO2-4',
						'*1A PLANNED FLIGHT INFO*              LH7485   44 TH 15MAR18    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'SEA          0815  TH FAJCDZPYBMU/R       739         4:56      ',
						'                      HQVWSTLK/R                                ',
						'IAD 1611  TH                                                4:56',
						'',
						'COMMENTS-',
						' 1.SEA IAD   - COMMERCIAL DUPLICATE - OPERATED BY              ',
						'               UNITED AIRLINES',
						' 2.SEA IAD   - AIRCRAFT OWNER UNITED AIRLINES                   ',
						' 3.ENTIRE FLT- G/ QUALIFIED ONLINE CONNECTING TRAFFIC ONLY      ',
						' 4.SEA IAD   - OPERATIONAL LEG UA 0419                          ',
						' 5.SEA IAD   - MCT FLIGHT TRACKING D/D                          ',
						' 6.SEA IAD   - SECURED FLIGHT                                   ',
						' 7.SEA IAD   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 8.SEA IAD   - SEC FLT PSGR DATA REQUIRED 72 HBD SSR DOCS       ',
						' 9.SEA IAD   - US LAW SEE GGAIRLH PNR ACCESS OR NEWS KEYWORDS   ',
						'10.SEA IAD   - F20Y159                                          ',
						'11.SEA IAD   -  CO2/PAX* 277.72 KG ECO, 555.43 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$               739  F 999   C 999   M 999                       ',
						'*1A PLANNED FLIGHT INFO*              LH9051   44 TH 15MAR18    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'IAD          1825  TH FAJCDZPYBMU/M       777         7:45      ',
						'                      HQVWSTLK/M                                ',
						'FRA 0710  FR                                                7:45',
						'',
						'COMMENTS-',
						' 1.IAD FRA   - COMMERCIAL DUPLICATE - OPERATED BY              ',
						'               UNITED AIRLINES',
						' 2.IAD FRA   - AIRCRAFT OWNER UNITED AIRLINES                   ',
						' 3.IAD FRA   - OPERATIONAL LEG UA 0989                          ',
						' 4.IAD FRA   - ARRIVES TERMINAL 1                               ',
						' 5.IAD FRA   - MCT FLIGHT TRACKING I/I                          ',
						' 6.IAD FRA   - SECURED FLIGHT                                   ',
						' 7.IAD FRA   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 8.IAD FRA   - SEC FLT PSGR DATA REQUIRED 72 HBD SSR DOCS       ',
						' 9.IAD FRA   - US LAW SEE GGAIRLH PNR ACCESS OR NEWS KEYWORDS   ',
						'10.IAD FRA   - F8C40Y221                                        ',
						'11.IAD FRA   -  CO2/PAX* 409.16 KG ECO, 818.32 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$               777  F   8   C  40   M 221                       ',
						'*1A PLANNED FLIGHT INFO*              UA8717   56 TU 27MAR18    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'FRA          1045  TU JCDZPYBMUHQ/M       744        10:10      ',
						'                      VWSTLK/M                                  ',
						'SEA 1155  TU                                               10:10',
						'',
						'COMMENTS-',
						' 1.FRA SEA   - COMMERCIAL DUPLICATE - OPERATED BY              ',
						'               LUFTHANSA',
						' 2.FRA SEA   - AIRCRAFT OWNER LUFTHANSA                         ',
						' 3.FRA SEA   - OPERATIONAL LEG LH 0490                          ',
						' 4.FRA SEA   - DEPARTS TERMINAL 1                               ',
						' 5.FRA SEA   - MCT FLIGHT TRACKING I/I                          ',
						' 6.FRA SEA   - CHECK-IN /LUFTHANSA                              ',
						' 7.FRA SEA   - SECURED FLIGHT                                   ',
						' 8.FRA SEA   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 9.FRA SEA   -  CO2/PAX* 511.40 KG ECO, 1,022.80 KG PRE         ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               744  NO CONFIGURATION SET                        ',
						' ',
					]),
				},
				{
					'cmd': 'FQN1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1*16',
						'',
						'1 - PSGR P1 ADT',
						' FQN 1-1    ADT SEAFRA LH  KLNC34N',
						' FQN 1-2    ADT FRASEA UA  LLNC14N',
						'                                                  PAGE  1/ 1',
						' ',
					]),
				},
				{
					'cmd': 'FQN1-1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1-1*16',
						'',
						' 1 - PSGR P1 ADT                                   RULES DISPLAY',
						'FARE COMPONENT  1    ADT SEAFRA LH  KLNC34N',
						'FCL: KLNC34N   TRF:   1 RULE: E601 BK:  K',
						'PTC: ADT-ADULT              FTC: XAN-NON REFUNDABLE APEX',
						'PE.PENALTIES',
						'',
						'  CANCELLATIONS',
						'',
						'    ANY TIME',
						'      TICKET IS NON-REFUNDABLE.',
						'      WAIVED FOR DEATH OF PASSENGER OR FAMILY MEMBER.',
						'         NOTE -',
						'          WAIVERS MUST BE EVIDENCED BY DEATH CERTIFICATE.',
						'          REFUND PERMITTED BEFORE DEPARTURE IN CASE OF',
						'          REJECTION OF VISA. EMBASSY STATEMENT REQUIRED.',
						'          ----',
						'          REFUND RULES APPLY PER PRICING UNIT.',
						'          ----',
						'          WHEN COMBINING NON-REFUNDABLE FARES WITH',
						'                                                  PAGE  1/ 2',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          REFUNDABLE FARES',
						'          1. THE MOST RESTRICTIVE CANCELLATION CONDITION',
						'          APPLIES TO THE ENTIRE PRICING UNIT.',
						'          2. THE HIGHEST CANCELLATION PENALTY WITHIN THE',
						'          PRICING UNIT WILL BE CHARGED.',
						'          ----',
						'          REFUND OF UNUSED TAXES PAID TO THIRD PARTIES',
						'          PERMITTED.',
						'          EXCEPT FOR PASSENGER FACILITY CHARGES APPLICABLE',
						'          TO US AIRPORTS WITH TAX CODES- US/ZP/XF AND FOR',
						'          OTHER TAXES WHICH LEGALLY ARE NON-REFUNDABLE.',
						'          REFUND OF UNUSED YQ NOT PERMITTED.',
						'          REFUND OF UNUSED YR NOT PERMITTED.',
						'          THIS ALSO INCLUDES LH/LX/OS/SN DCC - DISTRIBUTION',
						'          COST CHARGE- SHOWN AS YR ON THE TICKET.',
						'          ----',
						'          THE OPTIONAL PAYMENT CHARGE IS NON-REFUNDABLE.',
						'          ----',
						'          SHOULD THE FARE FOR THE ACTUAL FLOWN TRAVEL BE',
						'          HIGHER THAN THE ORIGINAL PAID FARE AMOUNT THE',
						'          FARE DIFFERENCE MUST BE COLLECTED.',
						'                                                  PAGE  2/ 2',
						' ',
					]),
				},
				{
					'cmd': 'FQN1-2*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1-2*16',
						'',
						' 1 - PSGR P1 ADT                                   RULES DISPLAY',
						'FARE COMPONENT  2    ADT FRASEA UA  LLNC14N',
						'FCL: LLNC14N   TRF:   1 RULE: E601 BK:  L',
						'PTC: ADT-ADULT              FTC: XAN-NON REFUNDABLE APEX',
						'PE.PENALTIES',
						'FOR ROUND TRIP LLNC14N TYPE FARES',
						'',
						'',
						'         NOTE -',
						'          --',
						'            HALF ROUNDTRIP FARE COMBINATION OF',
						'            NON-REFUNDABLE / REFUNDABLE WITH A CANCELLATION',
						'            PENALTY / FULLY REFUNDABLE',
						'            - THE MOST RESTRICTIVE CANCELLATION PENALTY',
						'            RULE APPLIES TO THE ENTIRE PRICING UNIT FOR',
						'            WHOLLY UNUSED TICKET -',
						'          --',
						'',
						'         NOTE -',
						'                                                  PAGE  1/ 2',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'          --',
						'               NON-REFUNDABLE APPLIES TO ADT/CHD/INF',
						'          --',
						'               YR / YQ  INTERNATIONAL SURCHARGE',
						'                     WILL NOT BE REFUNDED',
						'          --',
						'                 TAX/CHARGE -  US / ZP / XF',
						'                     WILL NOT BE REFUNDED',
						'            NON-REFUNDABLE ON NON-REFUNDABLE FARE TICKETS',
						'          --',
						'',
						'  CANCELLATIONS',
						'',
						'    ANY TIME',
						'      TICKET IS NON-REFUNDABLE IN CASE OF CANCEL/NO-SHOW/',
						'        REFUND.',
						'      WAIVED FOR SCHEDULE CHANGE.',
						'         NOTE -',
						'          --',
						'          A.  EXCHANGE - WHOLLY UNUSED TICKET / CHANGE',
						'                 TO 1ST TICKETED FLIGHT COUPON',
						'                                                  PAGE  2/ 2',
						' ',
					]),
				},
			],
		});

		// FQQ command should be taken from cache in terminal.importPq after terminal.getPqItinerary
		$list.push({
			'input': {
				'useStatefulRules': true,
				'leadData': [],
				'previousCommands': [
					{
						'cmd': 'FXX/RADT*INF',
						'output': php.implode(php.PHP_EOL, [
							'FXX/RADT*INF',
							'',
							'',
							'   PASSENGER         PTC    NP  FARE USD  TAX/FEE   PER PSGR',
							'01 1                 ADT     1     742.00   88.60     830.60',
							'02 2                 INF     1      74.00    0.00      74.00',
							'',
							'                   TOTALS    2     816.00   88.60     904.60',
							'',
							'FXU/TS TO UPSELL EC FOR -653.00USD',
							'1-2 FARE FAMILIES:ER',
							'1-2 LAST TKT DTE 05MAY18/23:59 LT in POS - SEE ADV PURCHASE',
							'1-2 TICKETS ARE NON-REFUNDABLE',
							'                                                  PAGE  2/ 2',
							' ',
						]),
					},
					{
						'cmd': 'RT',
						'output': php.implode(php.PHP_EOL, [
							'/$--- MSC ---',
							'RP/SFO1S2195/',
							'  1  SU1845 Y 10MAY 4*KIVSVO DK1  1250A 345A 10MAY  E  0 32A S',
							'     SEE RTSVC',
							'  2  SU2682 Y 10MAY 4*SVORIX DK1   915A1050A 10MAY  E  0 73H S',
							'     010 BT 7425',
							'     SEE RTSVC',
							' ',
						]),
					},
					{
						'cmd': 'FQQ1',
						'output': php.implode(php.PHP_EOL, [
							'FQQ1',
							'',
							'01 P1',
							'',
							'LAST TKT DTE 05MAY18/23:59 LT in POS - SEE ADV PURCHASE',
							'------------------------------------------------------------',
							'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
							' KIV',
							'XMOW SU  1845 Y    10MAY 0050  YVO             10MAY10MAY 1P',
							' RIX SU  2682 Y    10MAY 0915  YVO             10MAY10MAY 1P',
							'',
							'EUR   600.00      10MAY18KIV SU X/MOW SU RIX710.34YVO NUC',
							'USD   742.00      710.34END ROE0.844659',
							'USD    51.95YQ    XT USD 11.13MD USD 7.67WW USD 7.38RI USD',
							'USD     3.09JQ    7.38RI',
							'USD    33.56XT',
							'USD   830.60',
							'RATE USED 1EUR=1.236856USD',
							'FARE FAMILIES:    (ENTER FQFn FOR DETAILS, FXY FOR UPSELL)',
							'FARE FAMILY:FC1:1-2:ER',
							'FXU/TS TO UPSELL EC FOR -594.00USD',
							'                                                  PAGE  3/ 4',
							' ',
						]),
					},
					{
						'cmd': 'MD',
						'output': php.implode(php.PHP_EOL, [
							'TICKET STOCK RESTRICTION',
							'BG CXR: 2*SU',
							'PRICED WITH VALIDATING CARRIER SU - REPRICE IF DIFFERENT VC',
							'TICKETS ARE NON-REFUNDABLE',
							'ENDOS NONREF/HEBO3BPATEH',
							'12MAR18 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
							'                                                  PAGE  4/ 4',
							' ',
						]),
					},
					{
						'cmd': 'FQQ2',
						'output': php.implode(php.PHP_EOL, [
							'FQQ2',
							'',
							'02 P2',
							'',
							'LAST TKT DTE 05MAY18/23:59 LT in POS - SEE ADV PURCHASE',
							'------------------------------------------------------------',
							'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
							' KIV',
							'XMOW SU  1845 Y    10MAY 0050  YVO/IN90        10MAY10MAY 1P',
							' RIX SU  2682 Y    10MAY 0915  YVO/IN90        10MAY10MAY 1P',
							'',
							'EUR    60.00      10MAY18KIV SU X/MOW SU RIX71.03YVO/IN90',
							'USD    74.00      NUC71.03END ROE0.844659',
							'',
							'',
							'',
							'USD    74.00',
							'RATE USED 1EUR=1.236856USD',
							'FARE FAMILIES:    (ENTER FQFn FOR DETAILS, FXY FOR UPSELL)',
							'FARE FAMILY:FC1:1-2:ER',
							'FXU/TS TO UPSELL EC FOR -59.00USD',
							'                                                  PAGE  3/ 4',
							' ',
						]),
					},
					{
						'cmd': 'MD',
						'output': php.implode(php.PHP_EOL, [
							'TICKET STOCK RESTRICTION',
							'BG CXR: 2*SU',
							'PRICED WITH VALIDATING CARRIER SU - REPRICE IF DIFFERENT VC',
							'TICKETS ARE NON-REFUNDABLE',
							'ENDOS NONREF/HEBO3BPATEH',
							'12MAR18 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
							'                                                  PAGE  4/ 4',
							' ',
						]),
					},
				],
			},
			'output': {
				'pnrData': {
					'currentPricing': {
						'cmd': 'FXX/RADT*INF',
						'parsed': {
							'pricingList': [
								{
									'quoteNumber': 1,
									'pricingBlockList': [
										{
											'ptcInfo': {'ptc': 'ADT', 'ptcRequested': 'ADT'},
											'validatingCarrier': 'SU',
											'fareInfo': {
												'baseFare': {'currency': 'EUR', 'amount': '600.00'},
												'fareEquivalent': {'currency': 'USD', 'amount': '742.00'},
												'totalFare': {'currency': 'USD', 'amount': '830.60'},
												'fareConstruction': {
													'segments': [
														{'airline': 'SU', 'destination': 'MOW'},
														{
															'airline': 'SU',
															'destination': 'RIX',
															'fare': '710.34',
															'fareBasis': 'YVO'
														},
													],
													'fare': '710.34',
												},
											},
										},
										{
											'ptcInfo': {'ptc': 'INF', 'ptcRequested': 'INF'},
											'fareInfo': {
												'baseFare': {'currency': 'EUR', 'amount': '60.00'},
												'fareEquivalent': {'currency': 'USD', 'amount': '74.00'},
												'totalFare': {'currency': 'USD', 'amount': '74.00'},
											},
										},
									],
								},
							],
						},
					},
				},
			},
			'calledCommands': [
				{
					'cmd': 'DO1-2',
					'output': php.implode(php.PHP_EOL, [
						'/$DO1-2',
						'*1A PLANNED FLIGHT INFO*              SU1845   59 TH 10MAY18    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'KIV          0050  TH JCDIZO/D  Y/S       32A         2:55      ',
						'                      BMUKHLXQTEN/S                             ',
						'                      RGV/S                                     ',
						'SVO 0345  TH                                                2:55',
						'',
						'COMMENTS-',
						' 1.KIV SVO   - ARRIVES TERMINAL D                               ',
						' 2.KIV SVO   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 3.KIV SVO   - Z999                                             ',
						' 4.KIV SVO   -  CO2/PAX* 119.91 KG ECO, 119.91 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               32A  NO CONFIGURATION SET                        ',
						'*1A PLANNED FLIGHT INFO*              SU2682   59 TH 10MAY18    ',
						'APT ARR   DY DEP   DY CLASS/MEAL          EQP  GRND  EFT   TTL  ',
						'SVO          0915  TH JCDIZOYBMUK/S       73H         1:35      ',
						'                      HLXQTENRGV/S                              ',
						'RIX 1050  TH                                                1:35',
						'',
						') ',
					]),
				},
				{
					'cmd': 'MDR',
					'output': php.implode(php.PHP_EOL, [
						'/$COMMENTS-',
						' 1.SVO RIX   - DEPARTS TERMINAL D                               ',
						' 2.SVO RIX   -  ET/ ELECTRONIC TKT CANDIDATE                    ',
						' 3.SVO RIX   - Z999                                             ',
						' 4.SVO RIX   -  CO2/PAX* 123.18 KG ECO, 123.18 KG PRE           ',
						' (*):SOURCE:ICAO CARBON EMISSIONS CALCULATOR                    ',
						'',
						'CONFIGURATION-',
						'               73H  NO CONFIGURATION SET                        ',
						' ',
					]),
				},
				{
					'cmd': 'FQN1*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN1*16',
						'',
						' 1 - PTC 1 ADT                                     RULES DISPLAY',
						'FARE COMPONENT  1    ADT KIVRIX SU  YVO',
						'FCL: YVO       TRF:  21 RULE: ES01 BK:  Y',
						'PTC: ADT-ADULT              FTC: SIP-ONEWAY INSTANT PURCHASE',
						'FARE FAMILY            : ER',
						'PE.PENALTIES',
						'',
						'  CANCELLATIONS',
						'',
						'    ANY TIME',
						'      TICKET IS NON-REFUNDABLE IN CASE OF CANCEL/NO-SHOW/',
						'        REFUND.',
						'',
						'  CHANGES',
						'',
						'    ANY TIME',
						'      CHARGE EUR 70.00 FOR REISSUE/REVALIDATION.',
						'',
						'    CHANGES NOT PERMITTED IN CASE OF NO-SHOW.',
						'                                                  PAGE  1/ 2',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'         NOTE -',
						'          ---                 //',
						'          // CHANGES BEFORE OUTBOUND DEPARTURE //',
						'                              //',
						'          1.WHEN THE FIRST FARE COMPONENT IS CHANGED -',
						'          THE ENTIRE TICKET MUST BE RE-PRICED USING',
						'          -CURRENT- FARES IN EFFECT ON THE DATE OF NEW',
						'          TICKET ISSUANCE.',
						'          ---',
						'          NEW FARE AMOUNT SHOULD BE EQUAL OR HIGHER THAN',
						'          PREVIOUS AMOUNT.',
						'          ---',
						'          ANY DIFFERENCE IN FARES PLUS CHANGE FEE MUST BE',
						'          COLLECTED.',
						'          ---',
						'          ALL RULE PROVISIONS OF THE NEW FARE INCLUDING',
						'          ADVANCE PURCHASE/MIN STAY/MAX STAY/',
						'          SEASONALITY/ETC MUST BE MET.',
						'          ---',
						'          2.WHEN THERE ARE NO CHANGE TO THE FIRST FARE',
						'          COMPONENT BUT OTHER FARE COMPONENTS ARE CHANGED -',
						'                                                  PAGE  2/ 2',
						' ',
					]),
				},
				{
					'cmd': 'FQN2*16',
					'output': php.implode(php.PHP_EOL, [
						'FQN2*16',
						'',
						' 2 - PTC 2 IN                                      RULES DISPLAY',
						'FARE COMPONENT  1    INF KIVRIX SU  YVO',
						'FCL: YVO       TRF:  21 RULE: ES01 BK:  Y',
						'PTC: INF-INFANT NOT OCCUPYI FTC: SIP-ONEWAY INSTANT PURCHASE',
						'FARE FAMILY            : ER',
						'PE.PENALTIES',
						'',
						'  CANCELLATIONS',
						'',
						'    ANY TIME',
						'      TICKET IS NON-REFUNDABLE IN CASE OF CANCEL/NO-SHOW/',
						'        REFUND.',
						'',
						'  CHANGES',
						'',
						'    ANY TIME',
						'      CHARGE EUR 70.00 FOR REISSUE/REVALIDATION.',
						'',
						'    CHANGES NOT PERMITTED IN CASE OF NO-SHOW.',
						'                                                  PAGE  1/ 2',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'         NOTE -',
						'          ---                 //',
						'          // CHANGES BEFORE OUTBOUND DEPARTURE //',
						'                              //',
						'          1.WHEN THE FIRST FARE COMPONENT IS CHANGED -',
						'          THE ENTIRE TICKET MUST BE RE-PRICED USING',
						'          -CURRENT- FARES IN EFFECT ON THE DATE OF NEW',
						'          TICKET ISSUANCE.',
						'          ---',
						'          NEW FARE AMOUNT SHOULD BE EQUAL OR HIGHER THAN',
						'          PREVIOUS AMOUNT.',
						'          ---',
						'          ANY DIFFERENCE IN FARES PLUS CHANGE FEE MUST BE',
						'          COLLECTED.',
						'          ---',
						'          ALL RULE PROVISIONS OF THE NEW FARE INCLUDING',
						'          ADVANCE PURCHASE/MIN STAY/MAX STAY/',
						'          SEASONALITY/ETC MUST BE MET.',
						'          ---',
						'          2.WHEN THERE ARE NO CHANGE TO THE FIRST FARE',
						'          COMPONENT BUT OTHER FARE COMPONENTS ARE CHANGED -',
						'                                                  PAGE  2/ 2',
						' ',
					]),
				},
			],
		});

		// infant has unique format row in PTC list - show retrieve all paxes nevertheless
		$list.push({
			'input': {
				'fetchOptionalFields': false,
				'useStatefulRules': false,
				'previousCommands': [
					{
						'cmd': 'FXX/RADT*C05*INF',
						'output': php.implode(php.PHP_EOL, [
							'FXX/RADT*C05*INF',
							'',
							'',
							'',
							'   PASSENGER         PTC    NP  FARE USD      TAX   PER PSGR',
							'01 1                 ADT     1     139.00   81.07     220.07',
							'02 2                 CNN     1     104.00   81.07     185.07',
							'03 3 INF             INF     1      15.00    0.00      15.00',
							'',
							'                   TOTALS    3     258.00  162.14     420.14',
							'',
							'1-3 LAST TKT DTE 13SEP18 - SEE ADV PURCHASE',
							'1-3 TICKETS ARE NON REFUNDABLE BEFORE DEPARTURE',
							'                                                  PAGE  1/ 1',
							' ',
						]),
					},
					{
						'cmd': 'RT',
						'output': php.implode(php.PHP_EOL, [
							'/$--- MSC ---',
							'RP/SFO1S2195/',
							'  1  PS 898 M 20SEP 4*KIVKBP DK1   720A 825A 20SEP  E  0 738 F',
							'     BOARDING PASS AT CHECKIN IS CHARGEABLE',
							'     FULL PASSPORT DATA IS MANDATORY',
							'     SEE RTSVC',
							'  2  PS 185 M 20SEP 4*KBPRIX DK1   920A1055A 20SEP  E  0 E90 F',
							'     BOARDING PASS AT CHECKIN IS CHARGEABLE',
							'     FULL PASSPORT DATA IS MANDATORY',
							'     SEE RTSVC',
							' ',
						]),
					},
				],
			},
			'output': {
				'pnrData': {
					'reservation': {
						'parsed': {
							'itinerary': [
								{'destinationAirport': 'KBP'},
								{'destinationAirport': 'RIX'},
							],
						},
					},
					'currentPricing': {
						'cmd': 'FXX/RADT*C05*INF',
						'parsed': {
							'pricingList': [
								{
									'pricingBlockList': [
										{
											'ptcInfo': {'ptc': 'ADT', 'ptcRequested': 'ADT'},
											'fareInfo': {
												'baseFare': {'currency': 'EUR', 'amount': '112.00'},
												'fareEquivalent': {'currency': 'USD', 'amount': '139.00'},
												'totalFare': {'currency': 'USD', 'amount': '220.07'},
											},
										},
										{
											'ptcInfo': {
												'ptc': 'CNN',
												'ptcRequested': 'C05',
												'ageGroup': 'child',
												'ageGroupRequested': 'child'
											},
											'fareInfo': {
												'baseFare': {'currency': 'EUR', 'amount': '84.00'},
												'fareEquivalent': {'currency': 'USD', 'amount': '104.00'},
												'totalFare': {'currency': 'USD', 'amount': '185.07'},
											},
										},
										{
											'ptcInfo': {
												'ptc': 'INF',
												'ptcRequested': 'INF',
												'ageGroup': 'infant',
												'ageGroupRequested': 'infant'
											},
											'fareInfo': {
												'baseFare': {'currency': 'EUR', 'amount': '12.00'},
												'fareEquivalent': {'currency': 'USD', 'amount': '15.00'},
												'totalFare': {'currency': 'USD', 'amount': '15.00'},
											},
										},
									],
								},
							],
						},
					},
				},
			},
			'calledCommands': [
				{
					'cmd': 'FQQ1',
					'output': php.implode(php.PHP_EOL, [
						'FQQ1',
						'',
						'01            *          * 1          *    220.07  *      *Y',
						'',
						'LAST TKT DTE 13SEP18/23:59 LT in POS - SEE ADV PURCHASE',
						'------------------------------------------------------------',
						'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
						' KIV',
						'XIEV PS   898 M    20SEP 0720  M1LEP4                     1P',
						' RIX PS   185 M    20SEP 0920  M1LEP4                     1P',
						'',
						'EUR   112.00      20SEP18KIV PS X/IEV PS RIX132.59M1LEP4 NUC',
						'USD   139.00      132.59END ROE0.844659',
						'USD    18.00YQ    XT USD 3.11JQ USD 11.18MD USD 7.70WW USD',
						'USD    28.58YR    4.00UA USD 8.50YK',
						'USD    34.49XT',
						'USD   220.07',
						'RATE USED 1EUR=1.24222USD',
						'BAG/SEAT/MEAL/SERVICES AT A CHARGE MAY BE AVAIL.-ENTER FXK',
						'TICKET STOCK RESTRICTION',
						'BG CXR: 2*PS',
						'                                                  PAGE  2/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'PRICED WITH VALIDATING CARRIER PS - REPRICE IF DIFFERENT VC',
						'TICKETS ARE NON REFUNDABLE BEFORE DEPARTURE',
						'ENDOS NON END/NO REF/RBK 50EUR',
						'29MAR18 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
						'                                                  PAGE  3/ 3',
						' ',
					]),
				},
				{
					'cmd': 'FQQ2',
					'output': php.implode(php.PHP_EOL, [
						'FQQ2',
						'',
						'02            * CNN      * 2          *    185.07  *      *Y',
						'',
						'LAST TKT DTE 13SEP18/23:59 LT in POS - SEE ADV PURCHASE',
						'------------------------------------------------------------',
						'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
						' KIV',
						'XIEV PS   898 M    20SEP 0720  M1LEP4/CH25                1P',
						' RIX PS   185 M    20SEP 0920  M1LEP4/CH25                1P',
						'',
						'EUR    84.00      20SEP18KIV PS X/IEV PS RIX99.44M1LEP4/CH25',
						'USD   104.00      NUC99.44END ROE0.844659',
						'USD    18.00YQ    XT USD 3.11JQ USD 11.18MD USD 7.70WW USD',
						'USD    28.58YR    4.00UA USD 8.50YK',
						'USD    34.49XT',
						'USD   185.07',
						'RATE USED 1EUR=1.24222USD',
						'BAG/SEAT/MEAL/SERVICES AT A CHARGE MAY BE AVAIL.-ENTER FXK',
						'TICKET STOCK RESTRICTION',
						'BG CXR: 2*PS',
						'                                                  PAGE  2/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'PRICED WITH VALIDATING CARRIER PS - REPRICE IF DIFFERENT VC',
						'TICKETS ARE NON REFUNDABLE BEFORE DEPARTURE',
						'ENDOS NON END/NO REF/RBK 50EUR',
						'29MAR18 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
						'                                                  PAGE  3/ 3',
						' ',
					]),
				},
				{
					'cmd': 'FQQ3',
					'output': php.implode(php.PHP_EOL, [
						'FQQ3',
						'',
						'03            * INF      * 3          *     15.00  *      *N',
						'',
						'LAST TKT DTE 13SEP18/23:59 LT in POS - SEE ADV PURCHASE',
						'------------------------------------------------------------',
						'     AL FLGT  BK   DATE  TIME  FARE BASIS      NVB  NVA   BG',
						' KIV',
						'XIEV PS   898 M    20SEP 0720  M1LEP4/IN90                1P',
						' RIX PS   185 M    20SEP 0920  M1LEP4/IN90                1P',
						'',
						'EUR    12.00      20SEP18KIV PS X/IEV PS RIX13.25M1LEP4/IN90',
						'USD    15.00      NUC13.25END ROE0.844659',
						'',
						'',
						'',
						'USD    15.00',
						'RATE USED 1EUR=1.24222USD',
						'BAG/SEAT/MEAL/SERVICES AT A CHARGE MAY BE AVAIL.-ENTER FXK',
						'TICKET STOCK RESTRICTION',
						'BG CXR: 2*PS',
						'                                                  PAGE  2/ 3',
						' ',
					]),
				},
				{
					'cmd': 'MD',
					'output': php.implode(php.PHP_EOL, [
						'PRICED WITH VALIDATING CARRIER PS - REPRICE IF DIFFERENT VC',
						'TICKETS ARE NON REFUNDABLE BEFORE DEPARTURE',
						'ENDOS NON END/NO REF/RBK 50EUR',
						'29MAR18 PER GAF REQUIREMENTS FARE NOT VALID UNTIL TICKETED',
						'                                                  PAGE  3/ 3',
						' ',
					]),
				},
			],
		});

		$argumentTuples = [];
		for ($testCase of Object.values($list)) {
			$argumentTuples.push([$testCase['input'], $testCase['output'], $testCase['calledCommands']]);
		}

		return $argumentTuples;
	}

	/**
	 * @test
	 * @dataProvider provideTestCases
	 */
	async testAction($input, $expectedOutput, $calledCommands) {
		let $actual;

		let full = $input['fetchOptionalFields'];
		full = full === undefined || full === true;
		if (full) {
			// TODO: remove once there is support for Amadeus importPq
			return;
		}
		$actual = await (new ImportPqAmadeusAction())
			.setGeoProvider(new StubLocationGeographyProvider([]))
			.useStatefulRules($input['useStatefulRules'])
			.setSession(new AnyGdsStubSession($calledCommands))
			.setPreCalledCommandsFromDb($input['previousCommands'],
				GdsDirectDefaults.makeDefaultAmadeusState())
			.setBaseDate('2018-03-20')
			.fetchOptionalFields(full)
			.execute();

		this.assertArrayElementsSubset($expectedOutput, $actual);
	}

	getTestMapping() {
		return [
			[this.provideTestCases, this.testAction],
		];
	}
}

ImportPqAmadeusActionTest.count = 0;
module.exports = ImportPqAmadeusActionTest;
