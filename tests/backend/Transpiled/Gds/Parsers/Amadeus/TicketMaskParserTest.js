
const php = require('../../../php.js');
const TicketMaskParser = require("../../../../../../backend/Transpiled/Gds/Parsers/Amadeus/TicketMaskParser");

class TicketMaskParserTest extends require('klesun-node-tools/src/Transpiled/Lib/TestCase.js') {
	provideDumps() {
		let $list;

		// note that all "X"-es on place of digits in credit card numbers were placed manually

		$list = [
			[
				php.implode(php.PHP_EOL, [
					'TKT-2357985411709-710    RCI-                     1A  LOC-2X3ZXR',
					' OD-CMHCMH  SI-      FCMI-6   POI-SFO  DOI-27JAN17  IOI-05578602',
					'   1.BAHRAMI/SADEGH            ADT            ST',
					' 1 OCMH UA6162   H 26FEB1445 OK WV5PC         O   26FEB26FEB 2PC',
					' 2 XIAD TK   8   W 26FEB2255 OK WV5PC         O   26FEB26FEB 2PC',
					' 3 XIST TK 874   W 27FEB2130 OK WV5PC         O   27FEB27FEB 2PC',
					' 4 OIKA TK 879   W 21MAR0740 OK WV5PC         O   21MAR21MAR 2PC',
					' 5 XIST TK   7   W 21MAR1505 OK WV5PC         O S 21MAR21MAR 2PC',
					' 6 XIAD UA6321   G 21MAR2205 OK WV5PC         O   21MAR21MAR 2PC',
					'    CMH',
					'FARE   F USD       467.00',
					'TOTALTAX USD       377.00',
					'TOTAL    USD       844.00 ',
					'ADD COLL USD       815.00',
					'/FC CMH UA X/WAS TK X/IST TK THR233.50WV5PC TK X/IST TK X/WAS UA',
					' CMH233.50WV5PC NUC467.00END ROE1.000000XF CMH4.5IAD4.5IAD4.5',
					'FE NONEND/TK ONLY -BG UA',
					'FO 235-5050366427SFO27JAN17/05578602/235-5050366427',
					'FP O/CASH+/CCVI41XXXXXXXXXXXX64/0617/A22754D',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{
					'ticketNumber': '2357985411709',
					'recordLocator': '2X3ZXR',
					'issueDate': {'parsed': '2017-01-27'},
					'pccIataCode': '05578602',
					'passengerName': 'BAHRAMI/SADEGH',
					'ptc': 'ADT',

					'baseFare': {'currency': 'USD', 'amount': '467.00'},
					'totalTax': {'currency': 'USD', 'amount': '377.00'},
					'netPrice': {'currency': 'USD', 'amount': '844.00'},
					'fareConstruction': {
						'raw': 'CMH UA X/WAS TK X/IST TK THR233.50WV5PC TK X/IST TK X/WAS UA CMH233.50WV5PC NUC467.00END ROE1.000000XF CMH4.5IAD4.5IAD4.5',
						'parsed': {
							'segments': [
								{'destination': 'WAS'},
								{'destination': 'IST'},
								{'destination': 'THR', 'fare': '233.50', 'fareBasis': 'WV5PC'},
								{'destination': 'IST'},
								{'destination': 'WAS'},
								{'destination': 'CMH', 'fare': '233.50', 'fareBasis': 'WV5PC'},
							],
							'fare': '467.00',
						},
					},
					'endorsementLines': ['NONEND/TK ONLY'],
					'originalIssue': {
						'airlineNumber': '235',
						'documentNumber': '5050366427',
						'location': 'SFO',
						'date': {'raw': '27JAN17', 'parsed': '2017-01-27'},
						'iata': '05578602',
					},
					'exchangedFor': {
						'airlineNumber': '235',
						'documentNumber': '5050366427',
					},
					'formOfPayment': [
						{'formOfPayment': 'cash'},
						{
							'formOfPayment': 'creditCard',
							'ccType': 'VI',
							'ccNumber': '41XXXXXXXXXXXX64',
							'expirationDate': {'parsed': '2017-06', 'raw': '0617'},
							'approvalCode': 'A22754D',
						},
					],
				},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-2357987860336        RCI-                     1A  LOC-35SWSA',
					' OD-WASWAS  SI-      FCMI-6   POI-SFO  DOI-15FEB17  IOI-05578602',
					'   1.SOBOWALE/OLABISIRISIKAT   ADT            ST',
					' 1 OIAD TK   8   U 16MAR2355 OK UV5PC         O   16MAR16MAR 2PC',
					' 2 XIST TK 694   U 17MAR1905 OK UV5PC         O   17MAR17MAR 2PC',
					' 3 OCAI TK 691   U 21MAR0935 OK UV5PC         O   21MAR21MAR 2PC',
					' 4 XIST TK   7   U 21MAR1505 OK UV5PC         O S 21MAR21MAR 2PC',
					'    IAD',
					'FARE   F USD       217.00',
					'TOTALTAX USD       382.16',
					'TOTAL    USD       599.16 ',
					'ADD COLL USD       548.16',
					'/FC WAS TK X/IST TK CAI108.50UV5PC TK X/IST TK WAS108.50UV5PC NU',
					'C217.00END ROE1.000000XF IAD4.5',
					'FE NONEND/TK ONLY -BG TK',
					'FO 235-5050447438SFO15FEB17/05578602/235-5050447438',
					'FP O/CASH+/CCVI47XXXXXXXXXXXX37/0320/A111734',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{
					'ticketNumber': '2357987860336',
					'recordLocator': '35SWSA',
					'issueDate': {'parsed': '2017-02-15'},
					'passengerName': 'SOBOWALE/OLABISIRISIKAT',
					'originalIssue': {
						'airlineNumber': '235',
						'documentNumber': '5050447438',
						'location': 'SFO',
						'date': {'raw': '15FEB17', 'parsed': '2017-02-15'},
						'iata': '05578602',
					},
					'exchangedFor': {
						'airlineNumber': '235',
						'documentNumber': '5050447438',
					},
				},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-2357987411680        RCI-                     1A  LOC-3YFWQQ',
					' OD-CHICHI  SI-      FCMI-6   POI-SFO  DOI-13FEB17  IOI-05578602',
					'   1.FLEISCHER/JACK            ADT            ST',
					' 1 OORD TK   6   P 10DEC2120 OK PV5PC         O S 10DEC10DEC 2PC',
					' 2 XIST TK 788   P 11DEC1820 OK PV5PC         O   11DEC11DEC 2PC',
					' 3 OTLV TK 785   U 27DEC1035 OK UV5PC         O   27DEC27DEC 2PC',
					' 4 XIST TK   5   U 27DEC1600 OK UV5PC         O S 27DEC27DEC 2PC',
					'    ORD',
					'FARE   F USD       321.00',
					'TOTALTAX USD       378.26',
					'TOTAL    USD       699.26 ',
					'ADD COLL USD       642.26',
					'/FC CHI TK X/IST TK TLV195.50PV5PC TK X/IST TK CHI125.50UV5PC NU',
					'C321.00END ROE1.000000XF ORD4.5',
					'FE NONEND/TK ONLY -BG TK',
					'FO 235-5050435467SFO13FEB17/05578602/235-5050435467',
					'FP O/CASH+/CCCA54XXXXXXXXXXXX15/0120/A28663P',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '2357987411680'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-2357987411681        RCI-                     1A  LOC-3YFWQQ',
					' OD-CHICHI  SI-      FCMI-6   POI-SFO  DOI-13FEB17  IOI-05578602',
					'   1.FLEISCHER/NOREENE         ADT            ST',
					' 1 OORD TK   6   P 10DEC2120 OK PV5PC         O S 10DEC10DEC 2PC',
					' 2 XIST TK 788   P 11DEC1820 OK PV5PC         O   11DEC11DEC 2PC',
					' 3 OTLV TK 785   U 27DEC1035 OK UV5PC         O   27DEC27DEC 2PC',
					' 4 XIST TK   5   U 27DEC1600 OK UV5PC         O S 27DEC27DEC 2PC',
					'    ORD',
					'FARE   F USD       321.00',
					'TOTALTAX USD       378.26',
					'TOTAL    USD       699.26 ',
					'ADD COLL USD       642.26',
					'/FC CHI TK X/IST TK TLV195.50PV5PC TK X/IST TK CHI125.50UV5PC NU',
					'C321.00END ROE1.000000XF ORD4.5',
					'FE NONEND/TK ONLY -BG TK',
					'FO 235-5050435468SFO13FEB17/05578602/235-5050435468',
					'FP O/CASH+/CCCA54XXXXXXXXXXXX15/0120/A28663P',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '2357987411681'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-2357985411674        RCI-                     1A  LOC-2YELAT',
					' OD-MIAMIA  SI-      FCMI-6   POI-SFO  DOI-27JAN17  IOI-05578602',
					'   1.SAFDAR/MOHAMMAD           ADT            ST',
					' 1 OMIA TK  78   U 12MAR2345 OK UV3XPC        O S 12MAR12MAR 2PC',
					' 2 XIST TK 714   U 13MAR2105 OK UV3XPC        O   13MAR13MAR 2PC',
					' 3 OLHE TK 715   U 25MAR0605 OK UV3XPC        O   25MAR25MAR 2PC',
					' 4 XIST TK  77   U 25MAR1535 OK UV3XPC        O   25MAR25MAR 2PC',
					'    MIA',
					'FARE   F USD       128.00',
					'TOTALTAX USD       643.15',
					'TOTAL    USD       771.15 ',
					'ADD COLL USD       730.15',
					'/FC MIA TK X/IST TK LHE49.00UV3XPC TK X/IST TK MIA Q30.00 49.00U',
					'V3XPC NUC128.00END ROE1.000000XF MIA4.5',
					'FE NONEND/TK ONLY -BG TK',
					'FO 235-5050365602SFO27JAN17/05578602/235-5050365602',
					'FP O/CASH+/CCAX37XXXXXXXXXXXX16/1021/A168402',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '2357985411674'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-2357986973556        RCI-                     1A  LOC-3O4OPW',
					' OD-LAXLAX  SI-      FCMI-6   POI-SFO  DOI-08FEB17  IOI-05578602',
					'   1.NAJAFI/SOUSAN             ADT            ST',
					' 1 OLAX TK  10   U 08MAR1845 OK UV3XPC        O   08MAR08MAR 2PC',
					' 2 XIST TK 874   U 09MAR2130 OK UV3XPC        O   09MAR09MAR 2PC',
					' 3 OIKA TK 879   U 21MAR0740 OK UV3XPC        O   21MAR21MAR 2PC',
					' 4 XIST TK   9   U 21MAR1355 OK UV3XPC        O S 21MAR21MAR 2PC',
					'    LAX',
					'FARE   F USD       109.00',
					'TOTALTAX USD       524.42',
					'TOTAL    USD       633.42 ',
					'ADD COLL USD       603.42',
					'/FC LAX TK X/IST TK THR54.50UV3XPC TK X/IST TK LAX54.50UV3XPC NU',
					'C109.00END ROE1.000000XF LAX4.5',
					'FE NONEND/TK ONLY -BG TK',
					'FO 235-5050416718SFO08FEB17/05578602/235-5050416718',
					'FP O/CASH+/CCVI42XXXXXXXXXXXX75/1219/A07245B',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '2357986973556'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-2357986973557        RCI-                     1A  LOC-3O4OPW',
					' OD-LAXLAX  SI-      FCMI-6   POI-SFO  DOI-08FEB17  IOI-05578602',
					'   1.NAJAFI/HOSSEIN            ADT            ST',
					' 1 OLAX TK  10   U 08MAR1845 OK UV3XPC        O   08MAR08MAR 2PC',
					' 2 XIST TK 874   U 09MAR2130 OK UV3XPC        O   09MAR09MAR 2PC',
					' 3 OIKA TK 879   U 21MAR0740 OK UV3XPC        O   21MAR21MAR 2PC',
					' 4 XIST TK   9   U 21MAR1355 OK UV3XPC        O S 21MAR21MAR 2PC',
					'    LAX',
					'FARE   F USD       109.00',
					'TOTALTAX USD       524.42',
					'TOTAL    USD       633.42 ',
					'ADD COLL USD       603.42',
					'/FC LAX TK X/IST TK THR54.50UV3XPC TK X/IST TK LAX54.50UV3XPC NU',
					'C109.00END ROE1.000000XF LAX4.5',
					'FE NONEND/TK ONLY -BG TK',
					'FO 235-5050416717SFO08FEB17/05578602/235-5050416717',
					'FP O/CASH+/CCVI42XXXXXXXXXXXX75/1219/A07245B',
					'FOR TAX/FEE DETAILS USE TWD/TAX',
					'FREQUENT FLYER UA-865869'
				]),
				{'ticketNumber': '2357986973557'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-1577988810654        RCI-                     1A  LOC-4KY9KN',
					' OD-LAXLAX  SI-      FCMI-6   POI-SFO  DOI-22FEB17  IOI-05578602',
					'   1.SENTHILKUMAR/SANKARI      ADT            ST',
					' 1 OLAX QR 740   R 11APR1555 OK RJR5N5NX      O   11APR11AUG 2PC',
					' 2 XDOH QR 528   R 12APR1910 OK RJR5N5NX      O   11APR11AUG 2PC',
					' 3 OMAA QR 529   R 20APR0330 OK RJR5N5NX      O   11APR11AUG 2PC',
					' 4 XDOH QR 739   R 20APR0730 OK RJR5N5NX      O   11APR11AUG 2PC',
					'    LAX',
					'FARE   I               IT',
					'TOTALTAX USD       854.01',
					'TOTAL                  IT ',
					'ADD COLL USD      3280.01',
					'/FC LAX QR X/DOH QR MAA M/IT RJR5N5NX QR X/DOH QR LAX M/IT RJR5N',
					'5NX END XF LAX4.5',
					'FE /C1-4 NON END CHANGE FEE APPLIES VALID ON QR ONLY -BG QR',
					'FO 157-5050476971SFO22FEB17/05578602/157-5050476971',
					'FP O/CASH+/CCAX37XXXXXXXXXXXX05/0521/A135122',
					'NON-ENDORSABLE',
					'FOR TAX/FEE DETAILS USE TWD/TAX',
					'NET REPORTING IT/BT'
				]),
				{'ticketNumber': '1577988810654'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-1577988810655        RCI-                     1A  LOC-4KY9KN',
					' OD-LAXLAX  SI-      FCMI-6   POI-SFO  DOI-22FEB17  IOI-05578602',
					'   1.SENTHILKUMAR/NADARAJAH    ADT            ST',
					' 1 OLAX QR 740   R 11APR1555 OK RJR5N5NX      O   11APR11AUG 2PC',
					' 2 XDOH QR 528   R 12APR1910 OK RJR5N5NX      O   11APR11AUG 2PC',
					' 3 OMAA QR 529   R 20APR0330 OK RJR5N5NX      O   11APR11AUG 2PC',
					' 4 XDOH QR 739   R 20APR0730 OK RJR5N5NX      O   11APR11AUG 2PC',
					'    LAX',
					'FARE   I               IT',
					'TOTALTAX USD       854.01',
					'TOTAL                  IT ',
					'ADD COLL USD      3280.01',
					'/FC LAX QR X/DOH QR MAA M/IT RJR5N5NX QR X/DOH QR LAX M/IT RJR5N',
					'5NX END XF LAX4.5',
					'FE /C1-4 NON END CHANGE FEE APPLIES VALID ON QR ONLY -BG QR',
					'FO 157-5050476970SFO22FEB17/05578602/157-5050476970',
					'FP O/CASH+/CCAX37XXXXXXXXXXXX05/0521/A135122',
					'NON-ENDORSABLE',
					'FOR TAX/FEE DETAILS USE TWD/TAX',
					'NET REPORTING IT/BT'
				]),
				{'ticketNumber': '1577988810655'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-0717987860215        RCI-                     1A  LOC-35HPDB',
					' OD-ABVADD  SI-      FCMI-F   POI-SFO  DOI-15FEB17  IOI-05578602',
					'   1.MCCRACKEN/KATE ELIZABETH  ADT            ST',
					' 1 OABV ET 910   L 02MAR1310 OK LOWNG         O              2PC',
					'    ADD',
					'FARE   F USD       499.00',
					'TOTALTAX USD       136.95',
					'TOTAL    USD       635.95 ',
					'/FC ABV ET ADD Q4.00 494.76LOWNG NUC498.76END ROE1.000000',
					'FE NON-ENDO/PENALTIES APPLY',
					'FP CASH',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '0717987860215', 'passengerName': 'MCCRACKEN/KATE ELIZABETH'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-0717986973727        RCI-                     1A  LOC-3QFH9B',
					' OD-WASWAS  SI-      FCMI-9   POI-SFO  DOI-09FEB17  IOI-05578602',
					'   1.FONES/ABIGAILFAUPEL       ADT            ST',
					' 1 OIAD ET 501   T 01JUL1100 OK TOWUSCH       O   01JUL01JUL 2PC',
					' 2 XADD ET 847   T 02JUL0825 OK TOWUSCH       O   02JUL02JUL 2PC',
					' 3 OCPT ET 846   T 31AUG1455 OK TOWUSCH       O   31AUG31AUG 2PC',
					' 4 XADD ET 500   T 01SEP2215 OK TOWUSCH       O   01SEP01SEP 2PC',
					'    IAD',
					'FARE   I               IT',
					'TOTALTAX USD       629.28',
					'TOTAL                  IT ',
					'/FC WAS ET X/ADD ET CPT 127.50TOWUSCH ET X/ADD ET WAS 127.50TOWU',
					'SCH NUC255.00END ROE1.0XF IAD4.5',
					'FE NON-END VALID ON ET ONLY AND INTERLINE PARTNERS',
					'FP CCVI43XXXXXXXXXXXX43/0319/N03580C',
					'FT IAD16001',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '0717986973727', 'passengerName': 'FONES/ABIGAILFAUPEL'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-0717986973728        RCI-                     1A  LOC-3QFH9B',
					' OD-WASWAS  SI-      FCMI-9   POI-SFO  DOI-09FEB17  IOI-05578602',
					'   1.FONES/CATHERINEFAUPEL     ADT            ST',
					' 1 OIAD ET 501   T 01JUL1100 OK TOWUSCH       O   01JUL01JUL 2PC',
					' 2 XADD ET 847   T 02JUL0825 OK TOWUSCH       O   02JUL02JUL 2PC',
					' 3 OCPT ET 846   T 31AUG1455 OK TOWUSCH       O   31AUG31AUG 2PC',
					' 4 XADD ET 500   T 01SEP2215 OK TOWUSCH       O   01SEP01SEP 2PC',
					'    IAD',
					'FARE   I               IT',
					'TOTALTAX USD       629.28',
					'TOTAL                  IT ',
					'/FC WAS ET X/ADD ET CPT 127.50TOWUSCH ET X/ADD ET WAS 127.50TOWU',
					'SCH NUC255.00END ROE1.0XF IAD4.5',
					'FE NON-END VALID ON ET ONLY AND INTERLINE PARTNERS',
					'FP CCVI43XXXXXXXXXXXX43/0319/N03580C',
					'FT IAD16001',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{
					'ticketNumber': '0717986973728',
					'recordLocator': '3QFH9B',
					'departureCity': 'WAS',
					'destinationCity': 'WAS',
					'fcMode': '9',
					'issuePlace': 'SFO',
					'issueDate': {'raw': '09FEB17', 'parsed': '2017-02-09'},
					'pccIataCode': '05578602',
					'passengerName': 'FONES/CATHERINEFAUPEL',
					'ptc': 'ADT',
					'segments': [
						{'departureAirport': 'IAD', 'fareBasis': 'TOWUSCH'},
						{'departureAirport': 'ADD', 'fareBasis': 'TOWUSCH'},
						{'departureAirport': 'CPT', 'fareBasis': 'TOWUSCH'},
						{'departureAirport': 'ADD', 'fareBasis': 'TOWUSCH'},
						{'departureAirport': 'IAD', 'type': 'void'},
					],
					'fareVisibility': 'I',
					'baseFare': {'currency': null, 'amount': 'IT'},
					'fareEquivalent': null,
					'totalTax': {'currency': 'USD', 'amount': '629.28'},
					'netPrice': {'currency': null, 'amount': 'IT'},
					'additionalCollection': null,
					'fareConstruction': {
						'parsed': {
							'segments': [
								{'destination': 'ADD'},
								{'destination': 'CPT', 'fare': '127.50', 'fareBasis': 'TOWUSCH'},
								{'destination': 'ADD'},
								{'destination': 'WAS', 'fare': '127.50', 'fareBasis': 'TOWUSCH'},
							],
							'fare': '255.00',
						},
					},
					'endorsementLines': ['NON-END VALID ON ET ONLY AND INTERLINE PARTNERS'],
					'formOfPayment': [
						{
							'formOfPayment': 'creditCard',
							'ccType': 'VI',
							'ccNumber': '43XXXXXXXXXXXX43',
							'expirationDate': {'parsed': '2019-03', 'raw': '0319'},
							'approvalCode': 'N03580C',
						},
					],
					'tourCode': 'IAD16001',
				},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-0717986973729        RCI-                     1A  LOC-3QFH9B',
					' OD-WASWAS  SI-      FCMI-9   POI-SFO  DOI-09FEB17  IOI-05578602',
					'   1.FONES/JACKSONFAUPEL       ADT            ST',
					' 1 OIAD ET 501   T 01JUL1100 OK TOWUSCH       O   01JUL01JUL 2PC',
					' 2 XADD ET 847   T 02JUL0825 OK TOWUSCH       O   02JUL02JUL 2PC',
					' 3 OCPT ET 846   T 31AUG1455 OK TOWUSCH       O   31AUG31AUG 2PC',
					' 4 XADD ET 500   T 01SEP2215 OK TOWUSCH       O   01SEP01SEP 2PC',
					'    IAD',
					'FARE   I               IT',
					'TOTALTAX USD       629.28',
					'TOTAL                  IT ',
					'/FC WAS ET X/ADD ET CPT 127.50TOWUSCH ET X/ADD ET WAS 127.50TOWU',
					'SCH NUC255.00END ROE1.0XF IAD4.5',
					'FE NON-END VALID ON ET ONLY AND INTERLINE PARTNERS',
					'FP CCVI43XXXXXXXXXXXXXXXXXXXXX/0319/N03580C',
					'FT IAD16001',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '0717986973729', 'passengerName': 'FONES/JACKSONFAUPEL'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-0717986973730        RCI-                     1A  LOC-3QFH9B',
					' OD-WASWAS  SI-      FCMI-9   POI-SFO  DOI-09FEB17  IOI-05578602',
					'   1.FONES/JOHNJOSEPH          ADT            ST',
					' 1 OIAD ET 501   T 01JUL1100 OK TOWUS         O   01JUL01JUL 2PC',
					' 2 XADD ET 847   T 02JUL0825 OK TOWUS         O   02JUL02JUL 2PC',
					' 3 OCPT ET 846   T 31AUG1455 OK TOWUS         O   31AUG31AUG 2PC',
					' 4 XADD ET 500   T 01SEP2215 OK TOWUS         O   01SEP01SEP 2PC',
					'    IAD',
					'FARE   I               IT',
					'TOTALTAX USD       629.28',
					'TOTAL                  IT ',
					'/FC WAS ET X/ADD ET CPT 170.00TOWUS ET X/ADD ET WAS 170.00TOWUS ',
					'NUC340.00END ROE1.0XF IAD4.5',
					'FE BG ET NON-END VALID ON ET ONLY AND INTERLINE PARTNERS',
					'FP CCVI43XXXXXXXXXXXX43/0319/N03580C',
					'FT IAD16001',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '0717986973730', 'passengerName': 'FONES/JOHNJOSEPH'},
			],
			[
				// truncated name
				php.implode(php.PHP_EOL, [
					'TKT-2357986696306        RCI-                     1A  LOC-3JVC97',
					' OD-WASWAS  SI-      FCMI-6   POI-SFO  DOI-06FEB17  IOI-05578602',
					'   1.ASCHENBRENNER/NATHANAELANDADT            ST',
					' 1 OIAD TK   8   U 08MAR2255 OK UV3XPC        O   08MAR08MAR 2PC',
					' 2 XIST TK1867   U 10MAR0850 OK UV3XPC        O   10MAR10MAR 2PC',
					' 3 OVCE TK1868   U 21APR0925 OK UV3XPC        O   21APR21APR 2PC',
					' 4 XIST TK   7   U 21APR1445 OK UV3XPC        O   21APR21APR 2PC',
					'    IAD',
					'FARE   F USD        69.00',
					'TOTALTAX USD       473.94',
					'TOTAL    USD       542.94 ',
					'ADD COLL USD       498.94',
					'/FC WAS TK X/IST TK VCE34.50UV3XPC TK X/IST TK WAS34.50UV3XPC NU',
					'C69.00END ROE1.000000XF IAD4.5',
					'FE NONEND/TK ONLY -BG TK',
					'FO 235-5050405910SFO06FEB17/05578602/235-5050405910',
					'FP O/CASH+/CCVI42XXXXXXXXXXXX31/0819/A09637B',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{
					'ticketNumber': '2357986696306',
					'passengerName': 'ASCHENBRENNER/NATHANAELAND',
					'ptc': 'ADT',
				},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-2357986696329        RCI-                     1A  LOC-3J5W26',
					' OD-SFOSFO  SI-      FCMI-6   POI-SFO  DOI-06FEB17  IOI-05578602',
					'   1.LEWIS/OLGASERGEYEVNA      ADT            ST',
					' 1 OSFO TK  80   U 01MAR1810 OK UV3XPC        O   01MAR01MAR 2PC',
					' 2 XIST TK 467   U 02MAR2015 OK UV3XPC        O   02MAR02MAR 2PC',
					' 3 OODS TK 466   U 15MAY1025 OK UV3XPC        O   15MAY15MAY 2PC',
					' 4 XIST TK  79   U 15MAY1305 OK UV3XPC        O   15MAY15MAY 2PC',
					'    SFO',
					'FARE   F USD        59.00',
					'TOTALTAX USD       531.06',
					'TOTAL    USD       590.06 ',
					'ADD COLL USD       554.06',
					'/FC SFO TK X/IST TK ODS29.50UV3XPC TK X/IST TK SFO29.50UV3XPC NU',
					'C59.00END ROE1.000000XF SFO4.5',
					'FE NONEND/TK ONLY -BG TK',
					'FO 235-5050406783SFO06FEB17/05578602/235-5050406783',
					'FP O/CASH+/CCVI41XXXXXXXXXXXX58/0617/A62273D',
					'FOR TAX/FEE DETAILS USE TWD/TAX'
				]),
				{'ticketNumber': '2357986696329', 'passengerName': 'LEWIS/OLGASERGEYEVNA'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-0477986696510        RCI-                     1A  LOC-3LXYKF',
					' OD-MIAFRA  SI-      FCMI-N   POI-SFO  DOI-07FEB17  IOI-05578602',
					'   1.ALHASHIMI/ASAAD KHAZAL    ADT            ST',
					' 1 OMIA TP 224   K 26MAR1615 OK KLUSEUTP/CONS O   26MAR26MAR 1PC',
					' 2 XLIS TP 574   K 27MAR0825 OK KLUSEUTP/CONS O   27MAR27MAR 1PC',
					'    FRA',
					'FARE   I               IT',
					'TOTALTAX USD       141.83',
					'TOTAL                  IT ',
					'/FC MIA TP X/LIS TP FRA M/IT KLUSEUTP/CONS END XF MIA4.5',
					'FE FARE RESTR APPLY -BG TP',
					'FP CCCA54XXXXXXXXXXXX19/0620/A17340P',
					'FT IT6USCONS',
					'FOR TAX/FEE DETAILS USE TWD/TAX',
					'NET REPORTING IT/BT'
				]),
				{
					'ticketNumber': '0477986696510',
					'passengerName': 'ALHASHIMI/ASAAD KHAZAL',
					'tourCode': 'IT6USCONS',
				},
			],
			[
				// complete 'segments' data example
				php.implode(php.PHP_EOL, [
					'TKT-0477987176325        RCI-                     1A  LOC-3RKB3L',
					' OD-BOSVCE  SI-      FCMI-6   POI-SFO  DOI-09FEB17  IOI-05578602',
					'   1.ADAMS/GABRIEL             ADT            ST',
					' 1 OBOS TP 218   L 13MAR2100 OK LLUSEUTP/CONS O   13MAR13MAR 1PC',
					' 2 XLIS TP 866   L 14MAR0825 OK LLUSEUTP/CONS O   14MAR14MAR 1PC',
					'    VCE',
					'FARE   I               IT',
					'TOTALTAX USD       166.72',
					'TOTAL                  IT ',
					'ADD COLL USD       248.72',
					'/FC BOS TP X/LIS TP VCE M/IT LLUSEUTP/CONS END XF BOS4.5',
					'FE FARE RESTR APPLY -BG TP',
					'FO 047-5050420881SFO09FEB17/05578602/047-5050420881',
					'FP O/CASH+/CCVI41XXXXXXXXXXXX84/0620/A01563C',
					'FT IT6USCONS',
					'FOR TAX/FEE DETAILS USE TWD/TAX',
					'NET REPORTING IT/BT'
				]),
				{
					'ticketNumber': '0477987176325',
					'segments': [
						{
							'type': 'flight',
							'couponNumber': 1,
							'isStopover': true,
							'departureAirport': 'BOS',
							'airline': 'TP',
							'flightNumber': '218',
							'bookingClass': 'L',
							'departureDate': {'parsed': '03-13'},
							'departureTime': {'parsed': '21:00'},
							'bookingStatus': 'OK',
							'fareBasis': 'LLUSEUTP',
							'ticketDesignator': 'CONS',
							'couponStatus': 'O',
							'notValidBefore': {'parsed': '03-13'},
							'notValidAfter': {'parsed': '03-13'},
							'bagAmount': {'amount': '1', 'units': 'pieces'},
						},
						{
							'type': 'flight',
							'couponNumber': 2,
							'isStopover': false,
							'departureAirport': 'LIS',
							'airline': 'TP',
							'flightNumber': '866',
							'bookingClass': 'L',
							'departureDate': {'parsed': '03-14'},
							'departureTime': {'parsed': '08:25'},
							'bookingStatus': 'OK',
							'fareBasis': 'LLUSEUTP',
							'ticketDesignator': 'CONS',
							'couponStatus': 'O',
							'notValidBefore': {'parsed': '03-14'},
							'notValidAfter': {'parsed': '03-14'},
							'bagAmount': {'amount': '1', 'units': 'pieces'},
						},
						{
							'type': 'void',
							'departureAirport': 'VCE',
						},
					],
				},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-0477987411730        RCI-                     1A  LOC-3YJ5RL',
					' OD-NYCLON  SI-      FCMI-6   POI-SFO  DOI-13FEB17  IOI-05578602',
					'   1.HEBERT/CHELSEAMARIE       ADT            ST',
					' 1 OJFK TP 208   O 08MAR2340 OK OLUSEUTP/CONS O   08MAR08MAR 1PC',
					' 2 XLIS TP 348   O 10MAR0715 OK OLUSEUTP/CONS O   10MAR10MAR 1PC',
					'    LGW',
					'FARE   I               IT',
					'TOTALTAX USD       179.14',
					'TOTAL                  IT ',
					'ADD COLL USD       192.14',
					'/FC NYC TP X/LIS TP LON M/IT OLUSEUTP/CONS END XF JFK4.5',
					'FE FARE RESTR APPLY -BG TP',
					'FO 047-5050435967SFO13FEB17/05578602/047-5050435967',
					'FP O/CASH+/CCCA51XXXXXXXXXXXX26/0521/A007278',
					'FT IT6USCONS',
					'FOR TAX/FEE DETAILS USE TWD/TAX',
					'NET REPORTING IT/BT'
				]),
				{'ticketNumber': '0477987411730', 'passengerName': 'HEBERT/CHELSEAMARIE'},
			],
			[
				php.implode(php.PHP_EOL, [
					'TKT-0477987649210        RCI-                     1A  LOC-3Y7545',
					' OD-BOSROM  SI-      FCMI-6   POI-SFO  DOI-13FEB17  IOI-05578602',
					'   1.KURTENBACH/JOSEPH         ADT            ST',
					' 1 OBOS TP 218   Q 09MAR2000 OK QLUSEUTP/CONS O   09MAR09MAR 1PC',
					' 2 XLIS TP 846   Q 10MAR0930 OK QLUSEUTP/CONS O   10MAR10MAR 1PC',
					'    FCO',
					'FARE   I               IT',
					'TOTALTAX USD       166.70',
					'TOTAL                  IT ',
					'ADD COLL USD       417.70',
					'/FC BOS TP X/LIS TP ROM M/IT QLUSEUTP/CONS END XF BOS4.5',
					'FE FARE RESTR APPLY -BG TP',
					'FO 047-5050439228SFO13FEB17/05578602/047-5050439228',
					'FP O/CASH+/CCAX37XXXXXXXXXXXX05/0320/A115809',
					'FT IT6USCONS',
					'FOR TAX/FEE DETAILS USE TWD/TAX',
					'NET REPORTING IT/BT'
				]),
				{
					'ticketNumber': '0477987649210',
					'recordLocator': '3Y7545',
					'issueDate': {'raw': '13FEB17', 'parsed': '2017-02-13'},
					'passengerName': 'KURTENBACH/JOSEPH',
					'segments': [
						{'departureAirport': 'BOS', 'fareBasis': 'QLUSEUTP', 'ticketDesignator': 'CONS'},
						{'departureAirport': 'LIS', 'fareBasis': 'QLUSEUTP', 'ticketDesignator': 'CONS'},
						{'departureAirport': 'FCO', 'type': 'void'},
					],
					'fareVisibility': 'I',
					'baseFare': {'currency': null, 'amount': 'IT'},
					'additionalCollection': {'currency': 'USD', 'amount': '417.70'},
					'fareConstruction': {
						'raw': 'BOS TP X/LIS TP ROM M/IT QLUSEUTP/CONS END XF BOS4.5',
					},
					'endorsementLines': ['FARE RESTR APPLY'],
					'tourCode': 'IT6USCONS',
					'unparsedLines': ['FOR TAX/FEE DETAILS USE TWD/TAX', 'NET REPORTING IT/BT'],
				},
			]
		];

		// dump from Amadeus docs, with manually restored spaces
		// it has an ARNK segment and equivalent amount and currency without decimal part
		$list.push([
			php.implode(php.PHP_EOL, [
				'TKT-1762408164882-883    RCI-                     1A  LOC-YQYQM3',
				' OD-THRTHR  SI-      FCMI-0   POI-THR  DOI-30SEP10  IOI-33214462',
				'   1.RASOOLI/SMR               ADT            ST',
				' 1 OIKA EK0976   E 14OCT0405 OK EEE1YIR1      O   14OCT      30K',
				' 2 XDXB EK3364   E 14OCT0940 OK EEE1YIR1      O   14OCT      30K',
				' 3  CAN ARNK',
				' 4 OPVG EK0303   R 24OCT2330 OK REE1YIR1      O   14OCT      30K',
				' 5 XDXB EK0971   R 25OCT0745 OK REE1YIR1      O   14OCT      30K',
				'    IKA',
				'FARE   F USD      1727.00',
				'EQUIV    IRR     17718000       BSR 10259.00',
				'TOTALTAX IRR       208000',
				'TOTAL    IRR     17926000',
				'/FC THR EK X/DXB EK CAN924.00/-SHA EK X/DXB EK THR803.00NUC1727.',
				'00END ROE1.000000',
				'FE NON-END/SKYWARDS FLEX/',
				'FP CASH',
				'FOR TAX DETAILS USE TWD/TAX',
			]),
			{
				'ticketNumber': '1762408164882',
				'segments': [
					{'couponNumber': 1, 'departureAirport': 'IKA'},
					{'couponNumber': 2, 'departureAirport': 'DXB'},
					{'couponNumber': '3', 'departureAirport': 'CAN', 'type': 'void'},
					{'couponNumber': 4, 'departureAirport': 'PVG'},
					{'couponNumber': 5, 'departureAirport': 'DXB'},
					{'departureAirport': 'IKA', 'type': 'void'},
				],
				'baseFare': {'currency': 'USD', 'amount': '1727.00'},
				'fareEquivalent': {'currency': 'IRR', 'amount': '17718000', 'rateOfExchange': '10259.00'},
				'totalTax': {'currency': 'IRR', 'amount': '208000'},
				'netPrice': {'currency': 'IRR', 'amount': '17926000'},
				'fareConstruction': {
					'raw': 'THR EK X/DXB EK CAN924.00/-SHA EK X/DXB EK THR803.00NUC1727.00END ROE1.000000',
					'parsed': {
						'segments': [
							{'destination': 'DXB'},
							{'destination': 'CAN', 'fare': '924.00'},
							{'destination': 'DXB'},
							{'destination': 'THR', 'fare': '803.00'},
						],
						'fare': '1727.00',
					},
				},
				'endorsementLines': ['NON-END/SKYWARDS FLEX/'],
				'formOfPayment': [{'formOfPayment': 'cash'}],
			},
		]);

		$list.push([
			php.implode(php.PHP_EOL, [
				'TKT-9887075963023        RCI-                     1A  LOC-TXGXKX',
				' OD-HKTSAC  SI-      FCMI-6   POI-SFO  DOI-11JAN18  IOI-05578602',
				'   1.GREENE/BREKKANLYN MRS     ADT            ST',
				' 1 OHKT OZ 748   H 09FEB0200 OK KLOSU         O              2PC',
				' 2 XICN OZ 272   K 09FEB1820 OK KLOSU         O              2PC',
				' 3 OSEA AS 676   R 09FEB2145 OK R14TVN5       O   09FEB09FEB 2PC',
				'    SMF',
				'FARE   F THB        18625',
				'EQUIV    USD       578.00       BSR     0.031050',
				'TOTALTAX USD       228.57',
				'TOTAL    USD       806.57 ',
				'ADD COLL USD       773.57',
				'/FC HKT OZ X/SEL Q60.00OZ SEA447.95KLOSU AS SMF59.53R14TVN5 NUC5',
				'67.48END ROE32.815600 XF SEA4.5',
				'FE VALID AS/NON-REF/ CHNG SUBJ TO FEE -BG OZ',
				'FO 988-5053503462SFO11JAN18/05578602/988-5053503462',
				'FP O/CASH+/CCVIXXXXXXXXXXXX4826/1220/A102104',
				'FT 7UUHD833',
				'FOR TAX/FEE DETAILS USE TWD/TAX',
			]),
			{
				'ticketNumber': '9887075963023',
				'segments': [
					{'couponNumber': 1, 'departureAirport': 'HKT'},
					{'couponNumber': 2, 'departureAirport': 'ICN'},
					{'couponNumber': 3, 'departureAirport': 'SEA'},
					{'departureAirport': 'SMF', 'type': 'void'},
				],
				'baseFare': {'currency': 'THB', 'amount': '18625'},
				'fareEquivalent': {'currency': 'USD', 'amount': '578.00', 'rateOfExchange': '0.031050'},
				'totalTax': {'currency': 'USD', 'amount': '228.57'},
				'netPrice': {'currency': 'USD', 'amount': '806.57'},
				'fareConstruction': {
					'raw': 'HKT OZ X/SEL Q60.00OZ SEA447.95KLOSU AS SMF59.53R14TVN5 NUC567.48END ROE32.815600 XF SEA4.5',
					'parsed': {
						'segments': [
							{'destination': 'SEL', 'fuelSurcharge': '60.00'},
							{'destination': 'SEA', 'fare': '447.95', 'fareBasis': 'KLOSU'},
							{'destination': 'SMF', 'fare': '59.53', 'fareBasis': 'R14TVN5'},
						],
						'fare': '567.48',
					},
				},
				'endorsementLines': ['VALID AS/NON-REF/ CHNG SUBJ TO FEE'],
				'formOfPayment': [
					{'formOfPayment': 'cash'},
					{
						'formOfPayment': 'creditCard',
						'ccType': 'VI',
						'ccNumber': 'XXXXXXXXXXXX4826',
						'expirationDate': {'parsed': '2020-12', 'raw': '1220'},
						'approvalCode': 'A102104',
					},
				],
			},
		]);

		// with "AC" after airline and flight number. Is it operating airline?
		// yes, it is: >HELP TWD; >GPET2; >MS106;
		$list.push([
			php.implode(php.PHP_EOL, [
				'TKT-2578696598352-353    RCI-                     1A  LOC-L7I9HM',
				' OD-HOUHOU  SI-      FCMI-1   POI-SFO  DOI-11OCT17  IOI-05578602',
				'   1.AKHLAGHI/AMIR MR          ADT            ST',
				' 1 OIAH OS8302AC K 14DEC1215 OK KHNC5NS/PP03  F   14DEC14DEC 2PC',
				' 2 XYYZ OS  72   K 14DEC1810 OK KHNC5NS/PP03  F   14DEC14DEC 2PC',
				' 3 XVIE OS 871   K 15DEC2005 OK KHNC5NS/PP03  F   15DEC15DEC 2PC',
				' 4 OIKA LH 601   K 13JAN0230 OK KLNC5NS/PP08  F   13JAN13JAN 2PC',
				' 5 XFRA LH 440   K 13JAN0950 OK KLNC5NS/PP08  F   13JAN13JAN 2PC',
				'    IAH',
				'FARE   F USD       212.00',
				'TOTALTAX USD       606.98',
				'TOTAL    USD       818.98 ',
				'ADD COLL USD       805.95',
				'/FC HOU OS X/YTO OS X/VIE OS THR106.00KHNC5NS LH X/FRA LH HOU106',
				'.00KLNC5NS NUC212.00END ROE1.000000 XF IAH4.5',
				'FE NONREF/0VALUAFTDPT/CHGFEE -BG OS',
				'FO 257-5051376378SFO11OCT17/05578602/257-5051376378',
				'FP O/CASH+/CCVIXXXXXXXXXXXX2824/0919/A01697C',
				'FT 815ZU',
				'FOR TAX/FEE DETAILS USE TWD/TAX',
				'SAC-MULTI/USE TWH',
			]),
			{
				'ticketNumber': '2578696598352',
				'issueDate': {'full': '2017-10-11'},
				'passengerName': 'AKHLAGHI/AMIR MR',
				'segments': [
					{
						'type': 'flight',
						'couponNumber': 1,
						'isStopover': true,
						'departureAirport': 'IAH',
						'airline': 'OS',
						'flightNumber': '8302',
						'operatingAirline': 'AC',
						'bookingClass': 'K',
						'departureDate': {'raw': '14DEC', 'parsed': '12-14'},
						'departureTime': {'raw': '1215', 'parsed': '12:15'},
						'bookingStatus': 'OK',
						'fareBasis': 'KHNC5NS',
						'ticketDesignator': 'PP03',
						'couponStatus': 'F',
						'notValidBefore': {'raw': '14DEC', 'parsed': '12-14'},
						'notValidAfter': {'raw': '14DEC', 'parsed': '12-14'},
						'bagAmount': {'units': 'pieces', 'amount': '2'},
					},
					{
						'type': 'flight',
						'couponNumber': 2,
						'isStopover': false,
						'departureAirport': 'YYZ',
						'airline': 'OS',
						'flightNumber': '72',
						'operatingAirline': null,
						'bookingClass': 'K',
						'departureDate': {'raw': '14DEC', 'parsed': '12-14'},
						'departureTime': {'raw': '1810', 'parsed': '18:10'},
						'bookingStatus': 'OK',
						'fareBasis': 'KHNC5NS',
						'ticketDesignator': 'PP03',
						'couponStatus': 'F',
						'notValidBefore': {'raw': '14DEC', 'parsed': '12-14'},
						'notValidAfter': {'raw': '14DEC', 'parsed': '12-14'},
						'bagAmount': {'units': 'pieces', 'amount': '2'},
					},
					{'departureAirport': 'VIE', 'fareBasis': 'KHNC5NS'},
					{'departureAirport': 'IKA', 'fareBasis': 'KLNC5NS'},
					{'departureAirport': 'FRA', 'fareBasis': 'KLNC5NS'},
					{'departureAirport': 'IAH', 'type': 'void'},
				],
				'fareVisibility': 'F',
				'baseFare': {'currency': 'USD', 'amount': '212.00'},
				'fareEquivalent': null,
				'totalTax': {'currency': 'USD', 'amount': '606.98'},
				'netPrice': {'currency': 'USD', 'amount': '818.98'},
				'additionalCollection': {'currency': 'USD', 'amount': '805.95'},
			},
		]);

		// "/" after fare basis, but no ticket designator
		$list.push([
			php.implode(php.PHP_EOL, [
				'TKT-1767123028847        RCI-                     1A  LOC-RSMRMQ',
				' OD-DFWDFW  SI-      FCMI-9   POI-SFO  DOI-25JUL18  IOI-05578602',
				'   1.HAMMOND/LOGANJUSTIN       INF            ST',
				' 1 ODFW EK 222   L 27JUL1215 NS LKWJPUS2/     F        27JAN 1PC',
				' 2 XDXB EK 765   L 28JUL1440 NS LKWJPUS2/     F        27JAN 1PC',
				' 3 OJNB EK 762   L 09SEP1340 NS LKXJPUS2/     O        27JAN 1PC',
				' 4 XDXB EK 221   L 10SEP0250 NS LKXJPUS2/     O   03AUG27JAN 1PC',
				'    DFW',
				'FARE   I               IT',
				'TOTALTAX USD        58.81',
				'TOTAL                  IT ',
				'/FC DFW EK X/DXB EK JNB M/IT LKWJPUS2IN EK X/DXB EK DFW M/IT LKX',
				'JPUS2IN END',
				'FE NON-END/SAVER/REWARD UPGDSALLOWED WITH RESTRICTIONS -BG EK',
				'FP CCVIXXXXXXXXXXXX8146/0920/A002934',
				'FOR TAX/FEE DETAILS USE TWD/TAX',
				'NET REPORTING IT/BT',
				'FREQUENT FLYER EK-270495551',
			]),
			{
				'ticketNumber': '1767123028847',
				'issueDate': {'full': '2018-07-25'},
				'pccIataCode': '05578602',
				'nameNumber': 1,
				'passengerName': 'HAMMOND/LOGANJUSTIN',
				'ptc': 'INF',
				'segments': [
					{
						'type': 'flight',
						'couponNumber': 1,
						'isStopover': true,
						'departureAirport': 'DFW',
						'airline': 'EK',
						'flightNumber': '222',
						'bookingClass': 'L',
						'departureDate': {'raw': '27JUL', 'parsed': '07-27'},
						'departureTime': {'raw': '1215', 'parsed': '12:15'},
						'bookingStatus': 'NS',
						'fareBasis': 'LKWJPUS2',
						'ticketDesignator': null,
						'couponStatus': 'F',
						'bagAmount': {'units': 'pieces', 'amount': '1'},
					},
					{
						'type': 'flight',
						'couponNumber': 2,
						'isStopover': false,
						'departureAirport': 'DXB',
						'airline': 'EK',
						'flightNumber': '765',
						'bookingClass': 'L',
						'departureDate': {'raw': '28JUL', 'parsed': '07-28'},
						'departureTime': {'raw': '1440', 'parsed': '14:40'},
						'bookingStatus': 'NS',
						'fareBasis': 'LKWJPUS2',
						'ticketDesignator': null,
						'couponStatus': 'F',
						'bagAmount': {'units': 'pieces', 'amount': '1'},
					},
					{
						'type': 'flight',
						'couponNumber': 3,
						'isStopover': true,
						'departureAirport': 'JNB',
						'airline': 'EK',
						'flightNumber': '762',
						'bookingClass': 'L',
						'departureDate': {'raw': '09SEP', 'parsed': '09-09'},
						'departureTime': {'raw': '1340', 'parsed': '13:40'},
						'bookingStatus': 'NS',
						'fareBasis': 'LKXJPUS2',
						'ticketDesignator': null,
						'couponStatus': 'O',
						'bagAmount': {'units': 'pieces', 'amount': '1'},
					},
					{
						'type': 'flight',
						'couponNumber': 4,
						'isStopover': false,
						'departureAirport': 'DXB',
						'airline': 'EK',
						'flightNumber': '221',
						'operatingAirline': null,
						'bookingClass': 'L',
						'departureDate': {'raw': '10SEP', 'parsed': '09-10'},
						'departureTime': {'raw': '0250', 'parsed': '02:50'},
						'bookingStatus': 'NS',
						'fareBasis': 'LKXJPUS2',
						'ticketDesignator': null,
						'couponStatus': 'O',
						'notValidBefore': {'raw': '03AUG', 'parsed': '08-03'},
						'notValidAfter': {'raw': '27JAN', 'parsed': '01-27'},
						'bagAmount': {'units': 'pieces', 'amount': '1'},
					},
					{'departureAirport': 'DFW', 'type': 'void'},
				],
				'fareVisibility': 'I',
				'totalTax': {'currency': 'USD', 'amount': '58.81'},
				'netPrice': {'currency': null, 'amount': 'IT'},
				'fareConstruction': {
					'raw': 'DFW EK X/DXB EK JNB M/IT LKWJPUS2IN EK X/DXB EK DFW M/IT LKXJPUS2IN END',
				},
				'endorsementLines': ['NON-END/SAVER/REWARD UPGDSALLOWED WITH RESTRICTIONS'],
				'formOfPayment': [
					{'ccType': 'VI', 'ccNumber': 'XXXXXXXXXXXX8146'},
				],
			},
		]);

		// infant ticket, parser fails somewhere on "FARE   F MAD", probably because there are no taxes
		$list.push([
			php.implode(php.PHP_EOL, [
				'TKT-1477129117251        RCI-                     1A  LOC-OVZEXP',
				' OD-RAKPAR  SI-      FCMI-0   POI-SFO  DOI-12SEP18  IOI-05578602',
				'   1.ATTIK/SHAHEEN             INF            ST',
				' 1 ORAK AT 640   T 15SEP1005 NS TA0W0F0TI     A              10K',
				'    ORY',
				'FARE   F MAD       170.00',
				'EQUIV    USD        18.00       BSR     0.106320',
				'TOTAL    USD        18.00 ',
				'/FC RAK AT PAR17.64TA0W0F0TINF NUC17.64END ROE9.490640',
				'FE AT ONLY SUBJECT TO SPL CONDITIONS',
				'FP CASH',
			]),
			{
				'ticketNumber': '1477129117251',
				'recordLocator': 'OVZEXP',
				'departureCity': 'RAK',
				'destinationCity': 'PAR',
				'issuePlace': 'SFO',
				'issueDate': {'raw': '12SEP18', 'parsed': '2018-09-12', 'full': '2018-09-12'},
				'passengerName': 'ATTIK/SHAHEEN',
				'ptc': 'INF',
				'segments': [
					{'departureAirport': 'RAK', 'type': 'flight', 'fareBasis': 'TA0W0F0TI'},
					{'departureAirport': 'ORY', 'type': 'void'},
				],
				'fareVisibility': 'F',
				'baseFare': {'currency': 'MAD', 'amount': '170.00'},
				'fareEquivalent': {'currency': 'USD', 'amount': '18.00', 'rateOfExchange': '0.106320'},
				'totalTax': null,
				'netPrice': {'currency': 'USD', 'amount': '18.00'},
				'fareConstruction': {
					'parsed': {
						'segments': [
							{'destination': 'PAR', 'fare': '17.64', 'fareBasis': 'TA0W0F0TINF'},
						],
						'fare': '17.64',
						'rateOfExchange': '9.490640',
					},
				},
				'endorsementLines': ['AT ONLY SUBJECT TO SPL CONDITIONS'],
				'formOfPayment': [{'isOld': false, 'isForInf': false, 'formOfPayment': 'cash'}],
			},
		]);

		// TICKET NUMBER NOT FOUND error response example
		$list.push([
			php.implode(php.PHP_EOL, [
				'TK ETKT: TICKET NUMBER NOT FOUND',
				' ',
			]),
			{
				'airline': 'TK',
				'error': 'GDS returned error of type ticket_not_found',
				'errorType': 'ticket_not_found',
			},
		]);

		// different airline
		$list.push([
			php.implode(php.PHP_EOL, [
				'AS ETKT: TICKET NUMBER NOT FOUND',
				' ',
			]),
			{
				'airline': 'AS',
				'error': 'GDS returned error of type ticket_not_found',
				'errorType': 'ticket_not_found',
			},
		]);

		// NOT AUTHORISED
		$list.push([
			php.implode(php.PHP_EOL, [
				'SA ETKT: NOT AUTHORISED',
				' ',
			]),
			{
				'airline': 'SA',
				'error': 'GDS returned error of type not_authorised',
				'errorType': 'not_authorised',
			},
		]);

		// COMMUNICATIONS LINE UNAVAILABLE
		$list.push([
			php.implode(php.PHP_EOL, [
				'HX ETKT: COMMUNICATIONS LINE UNAVAILABLE',
				' ',
			]),
			{
				'airline': 'HX',
				'error': 'GDS returned error of type no_response_from_vendor',
				'errorType': 'no_response_from_vendor',
			},
		]);

		// SECURED error response example
		$list.push([
			php.implode(php.PHP_EOL, [
				'SECURED ETKT RECORD(S)',
				' ',
			]),
			{
				'error': 'GDS returned error of type no_agreement_exists',
				'errorType': 'no_agreement_exists',
			},
		]);

		$list.push([
			php.implode(php.PHP_EOL, [
				'DOCUMENT NUMBER NOT ELECTRONIC',
				' ',
			]),
			{
				'error': 'GDS returned error of type not_electronic',
				'errorType': 'not_electronic',
			},
		]);

		// fails with 'Invalid last airport line - 2 OHKG HXOPEN   W              WW6MA11W      O   14SEP14SEP 2PC'
		// OPEN segment example
		$list.push([
			php.implode(php.PHP_EOL, [
				'TKT-8517122516282        RCI-                     1A  LOC-WJCT7N',
				' OD-LAXLAX  SI-      FCMI-    POI-SFO  DOI-21JUL18  IOI-05578602',
				'   1.KIM/JAEYUN MR             ADT            ST',
				' 1 OLAX HX  69   W 30AUG1210 OK WX6MA11W      F   30AUG30AUG 2PC',
				' 2 OHKG HXOPEN   W              WW6MA11W      O   14SEP14SEP 2PC',
				'    LAX',
				'FARE   F USD       328.00',
				'TOTALTAX USD       244.51',
				'TOTAL    USD       572.51 ',
				'ADD COLL USD       513.01',
				'/FC LAX HX HKG144.00WX6MA11W HX LAX184.00WW6MA11W NUC328.00END R',
				'OE1.000000 XF LAX4.5',
				'FE Q/NONEND RFD USD200 REB/NOSH USD150 -BG HX',
				'FO 851-5054153429SFO21JUL18/05578602/851-5054153429',
				'FP O/CASH+/CCAXXXXXXXXXXXX1004/0323/A102476',
				'FOR TAX/FEE DETAILS USE TWD/TAX',
				' ',
			]),
			{
				'segments': [
					{'departureAirport': 'LAX', 'type': 'flight'},
					{'departureAirport': 'HKG', 'type': 'open'},
					{'departureAirport': 'LAX', 'type': 'void'},
				],
			},
		]);

		return $list;
	}

	/**
	 * @test
	 * @dataProvider provideDumps
	 */
	testParser($dump, $expected) {
		let $actual = TicketMaskParser.parse($dump);
		this.assertArrayElementsSubset($expected, $actual, $actual['error']);
	}

	getTestMapping() {
		return [
			[this.provideDumps, this.testParser],
		];
	}
}

TicketMaskParserTest.count = 0;
module.exports = TicketMaskParserTest;
