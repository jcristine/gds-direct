stages:
- test

# takes 1 minute and 9 seconds
run-tests-dev:
  before_script:
    - . /home/pkirpitsov/scripts/ci_secret_ssh.sh
  tags:
    #- dev-w13
  - sales-team-runner
  except:
    - tags
    - production
  script:
    - npm ci
    # dev-w13 has node 9.8 sadly, it has limited regex support
    - npm install node@10.14.1
    - node_modules/node/bin/node tests/run.js

# takes 16 seconds, could be even faster if it did not install node 10 each time...
run-tests-prod:
  before_script:
    - . /home/pkirpitsov/scripts/ci_secret_ssh.sh
  tags:
    - dev-w13
  only:
    #- tags
    - production
  script:
    # dev-w13 has node 9.8 sadly, it has limited regex support
    - npm install node@10.14.1
    - node_modules/node/bin/node tests/run.js
